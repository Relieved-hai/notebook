(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{1244:function(t,s,e){"use strict";e.r(s);var n=e(19),a=Object(n.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"坐标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#坐标","aria-hidden":"true"}},[t._v("#")]),t._v(" 坐标")]),t._v(" "),n("p",[t._v("要移动页面的元素，我们应该先熟悉坐标。")]),t._v(" "),n("p",[t._v("大多数 JavaScript 方法处理的是以下两种坐标系中的一个：")]),t._v(" "),n("ul",[n("li",[n("ol",[n("li",[n("strong",[t._v("相对于窗口")]),t._v(" — 类似于 "),n("code",[t._v("position:fixed")]),t._v("，从窗口的顶部/左侧边缘计算得出。")])]),t._v(" "),n("ul",[n("li",[t._v("我们将这些坐标表示为 "),n("code",[t._v("clientX/clientY")]),t._v("，当我们研究事件属性时，就会明白为什么使用这种名称来表示坐标。")])])]),t._v(" "),n("li",[n("ol",{attrs:{start:"2"}},[n("li",[n("strong",[t._v("相对于文档")]),t._v(" — 与文档根（document root）中的 "),n("code",[t._v("position:absolute")]),t._v(" 类似，从文档的顶部/左侧边缘计算得出。")])]),t._v(" "),n("ul",[n("li",[t._v("我们将它们表示为 "),n("code",[t._v("pageX/pageY")]),t._v("。")])])])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("当页面滚动到最开始时，此时窗口的左上角恰好是文档的左上角，它们的坐标彼此相等。但是，在文档移动之后，元素的窗口相对坐标会发生变化，因为元素在窗口中移动，而元素在文档中的相对坐标保持不变。")]),t._v(" "),n("p",[t._v("在下图中，我们在文档中取一点，并演示了它滚动之前（左）和之后（右）的坐标：")]),t._v(" "),n("p",[n("img",{attrs:{src:e(673),alt:""}})]),t._v(" "),n("p",[t._v("当文档滚动了：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("pageY")]),t._v(" — 元素在文档中的相对坐标保持不变，从文档顶部（现在已滚动出去）开始计算。")]),t._v(" "),n("li",[n("code",[t._v("clientY")]),t._v(" — 窗口相对坐标确实发生了变化（箭头变短了），因为同一个点越来越靠近窗口顶部。")])]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"元素坐标：getboundingclientrect"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#元素坐标：getboundingclientrect","aria-hidden":"true"}},[t._v("#")]),t._v(" 元素坐标：getBoundingClientRect")]),t._v(" "),n("p",[t._v("方法 "),n("code",[t._v("elem.getBoundingClientRect()")]),t._v(" 返回最小矩形的窗口坐标，该矩形将 "),n("code",[t._v("elem")]),t._v(" 作为内建 "),n("a",{attrs:{href:"https://www.w3.org/TR/geometry-1/#domrect",target:"_blank",rel:"noopener noreferrer"}},[t._v("DOMRect"),n("OutboundLink")],1),t._v(" 类的对象。")]),t._v(" "),n("p",[t._v("主要的 "),n("code",[t._v("DOMRect")]),t._v(" 属性：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("x/y")]),t._v(" — 矩形原点相对于窗口的 X/Y 坐标，")]),t._v(" "),n("li",[n("code",[t._v("width/height")]),t._v(" — 矩形的 width/height（可以为负）。")])]),t._v(" "),n("p",[t._v("此外，还有派生（derived）属性：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("top/bottom")]),t._v(" — 顶部/底部矩形边缘的 Y 坐标，")]),t._v(" "),n("li",[n("code",[t._v("left/right")]),t._v(" — 左/右矩形边缘的 X 坐标。")])]),t._v(" "),n("p",[t._v("例如，点击下面这个按钮以查看其窗口坐标：")]),t._v(" "),n("html",{attrs:{lang:"en"}},[n("head"),t._v(" "),n("body",[n("button",{attrs:{id:"abc",onclick:"abc()"}},[t._v("Get coordinates using button.getBoundingClientRect() for this button")]),t._v(" "),n("script",[t._v("\nfunction abc() {\n  let elem = document.getElementById('abc');\n  let rect = elem.getBoundingClientRect();\n  let log = '';\n  for (let key in rect) {\n    if (typeof rect[key] !== 'function') {\n      log += `${key} : ${rect[key]} \\n`\n    }\n  }\n  alert(log)\n}\n")])])]),t._v(" "),n("p",[t._v("如果你滚动此页面并重复点击上面那个按钮，你会发现随着窗口相对按钮位置的改变，其窗口坐标（如果你垂直滚动页面，则为 "),n("code",[t._v("y/top/bottom")]),t._v("）也随之改变。")]),t._v(" "),n("p",[t._v("下面这张是 "),n("code",[t._v("elem.getBoundingClientRect()")]),t._v(" 的输出的示意图：")]),t._v(" "),n("p",[n("img",{attrs:{src:e(674),alt:""}})]),t._v(" "),n("p",[t._v("正如你所看到的，"),n("code",[t._v("x/y")]),t._v(" 和 "),n("code",[t._v("width/height")]),t._v(" 对矩形进行了完整的描述。可以很容易地从它们计算出派生（derived）属性：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("left = x")])]),t._v(" "),n("li",[n("code",[t._v("top = y")])]),t._v(" "),n("li",[n("code",[t._v("right = x + width")])]),t._v(" "),n("li",[n("code",[t._v("bottom = y + height")])])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("请注意：")]),t._v(" "),n("ul",[n("li",[t._v("坐标可能是小数，例如 "),n("code",[t._v("10.5")]),t._v("。这是正常的，浏览器内部使用小数进行计算。在设置 "),n("code",[t._v("style.left/top")]),t._v(" 时，我们不是必须对它们进行舍入。")]),t._v(" "),n("li",[t._v("坐标可能是负数。例如滚动页面，使 "),n("code",[t._v("elem")]),t._v(" 现在位于窗口的上方，则 "),n("code",[t._v("elem.getBoundingClientRect().top")]),t._v(" 为负数。")])]),t._v(" "),n("br"),t._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",[n("strong",[t._v("为什么需要派生（derived）属性？如果有了 "),n("code",[t._v("x/y")]),t._v("，为什么还要还会存在 "),n("code",[t._v("top/left")]),t._v("？")])]),t._v(" "),n("p",[t._v("从数学上讲，一个矩形是使用其起点 "),n("code",[t._v("(x,y)")]),t._v(" 和方向向量 "),n("code",[t._v("(width,height)")]),t._v(" 唯一定义的。因此，其它派生属性是为了方便起见。")]),t._v(" "),n("p",[t._v("从技术上讲，"),n("code",[t._v("width/height")]),t._v(" 可能为负数，从而允许“定向（directed）”矩形，例如代表带有正确标记的开始和结束的鼠标选择。")]),t._v(" "),n("p",[t._v("负的 "),n("code",[t._v("width/height")]),t._v(" 值表示矩形从其右下角开始，然后向左上方“增长”。")]),t._v(" "),n("p",[t._v("这是一个矩形，其 "),n("code",[t._v("width")]),t._v(" 和 "),n("code",[t._v("height")]),t._v(" 均为负数（例如 "),n("code",[t._v("width=-200")]),t._v("，"),n("code",[t._v("height=-100")]),t._v("）：")]),t._v(" "),n("p",[n("img",{attrs:{src:e(675),alt:""}})]),t._v(" "),n("p",[t._v("正如你所看到的，在这个例子中，"),n("code",[t._v("left/top")]),t._v(" 与 "),n("code",[t._v("x/y")]),t._v(" 不相等。")]),t._v(" "),n("p",[t._v("但是实际上，"),n("code",[t._v("elem.getBoundingClientRect()")]),t._v(" 总是返回正数的 "),n("code",[t._v("width/height")]),t._v("，这里我们提及负的 "),n("code",[t._v("width/height")]),t._v(" 只是为了帮助你理解，为什么这些看起来重复的属性，实际上并不是重复的。")])]),t._v(" "),n("div",{staticClass:"warning custom-block"},[n("p",[n("strong",[t._v("IE 浏览器不支持 "),n("code",[t._v("x/y")])])]),t._v(" "),n("p",[t._v("由于历史原因，IE 浏览器不支持 "),n("code",[t._v("x/y")]),t._v(" 属性。")]),t._v(" "),n("p",[t._v("因此，我们可以写一个 polyfill（在 "),n("code",[t._v("DomRect.prototype")]),t._v(" 中添加一个 getter），或者仅使用 "),n("code",[t._v("top/left")]),t._v("，因为对于正值的 "),n("code",[t._v("width/height")]),t._v(" 来说，它们和 "),n("code",[t._v("x/y")]),t._v(" 一直是一样的，尤其是对于 "),n("code",[t._v("elem.getBoundingClientRect()")]),t._v(" 的结果。")])]),t._v(" "),n("div",{staticClass:"warning custom-block"},[n("p",[n("strong",[t._v("坐标的 right/bottom 与 CSS position 属性不同")])]),t._v(" "),n("p",[t._v("相对于窗口（window）的坐标和 CSS "),n("code",[t._v("position:fixed")]),t._v(" 之间有明显的相似之处。")]),t._v(" "),n("p",[t._v("但是在 CSS 定位中，"),n("code",[t._v("right")]),t._v(" 属性表示距右边缘的距离，而 "),n("code",[t._v("bottom")]),t._v(" 属性表示距下边缘的距离。")]),t._v(" "),n("p",[t._v("如果我们再看一下上面的图片，我们可以看到在 JavaScript 中并非如此。窗口的所有坐标都从左上角开始计数，包括这些坐标。")])]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"elementfrompoint-x-y"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#elementfrompoint-x-y","aria-hidden":"true"}},[t._v("#")]),t._v(" elementFromPoint(x, y)")]),t._v(" "),n("p",[t._v("对 "),n("code",[t._v("document.elementFromPoint(x, y)")]),t._v(" 的调用会返回在窗口坐标 "),n("code",[t._v("(x, y)")]),t._v(" 处嵌套最多（the most nested）的元素。")]),t._v(" "),n("p",[t._v("语法如下：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" elem "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("elementFromPoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("例如，下面的代码会高亮显示并输出现在位于窗口中间的元素的标签：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" centerX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("documentElement"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientWidth "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" centerY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("documentElement"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientHeight "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" elem "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("elementFromPoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("centerX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" centerY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nelem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("background "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"red"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tagName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("br"),t._v(" "),n("p",[t._v("因为它使用的是窗口坐标，所以元素可能会因当前滚动位置而有所不同。")]),t._v(" "),n("div",{staticClass:"warning custom-block"},[n("p",[n("strong",[t._v("对于在窗口之外的坐标，"),n("code",[t._v("elementFromPoint")]),t._v(" 返回 "),n("code",[t._v("null")])])]),t._v(" "),n("p",[t._v("方法 "),n("code",[t._v("document.elementFromPoint(x,y)")]),t._v(" 只对在可见区域内的坐标 "),n("code",[t._v("(x,y)")]),t._v(" 起作用。")]),t._v(" "),n("p",[t._v("如果任何坐标为负或者超过了窗口的 width/height，那么该方法就会返回 "),n("code",[t._v("null")]),t._v("。")]),t._v(" "),n("p",[t._v("在大多数情况下，这种行为并不是一个问题，但是我们应该记住这一点。")]),t._v(" "),n("p",[t._v("如果我们没有对其进行检查，可能就会发生下面这个典型的错误：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" elem "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("elementFromPoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果坐标恰好在窗口外，则 elem = null")]),t._v("\nelem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("background "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Error!")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])])]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"用于-“fixed”-定位"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用于-“fixed”-定位","aria-hidden":"true"}},[t._v("#")]),t._v(" 用于 “fixed” 定位")]),t._v(" "),n("p",[t._v("为了显示元素附近的东西，我们可以使用 "),n("code",[t._v("getBoundingClientRect")]),t._v(" 来获取其坐标，然后使用 CSS "),n("code",[t._v("position")]),t._v(" 以及 "),n("code",[t._v("left/top")]),t._v("（或 "),n("code",[t._v("right/bottom")]),t._v("）。")]),t._v(" "),n("p",[t._v("例如，下面的函数 "),n("code",[t._v("createMessageUnder(elem, html)")]),t._v(" 在 "),n("code",[t._v("elem")]),t._v(" 下显示了消息：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" elem "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"coords-show-mark"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createMessageUnder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("elem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建 message 元素")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" message "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在这里最好使用 CSS class 来定义样式")]),t._v("\n  message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cssText "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"position:fixed; color: red"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 分配坐标，不要忘记 "px"！')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" coords "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" elem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBoundingClientRect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" coords"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" coords"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bottom "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用法：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在文档中添加 message 保持 5 秒")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" message "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createMessageUnder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello, world!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br")])]),n("p",[t._v("点击下面这个按钮来运行它：")]),t._v(" "),n("html",{attrs:{lang:"en"}},[n("body",[n("button",{attrs:{id:"coords-show-mark",onclick:"qwe()"}},[t._v("Button with id=“coords-show-mark”, the message will appear under it")]),t._v(" "),n("script",[t._v('\nfunction qwe() {\n  // 用法：\n  // 在文档中添加 message 保持 5 秒\n  let message = createMessageUnder(document.getElementById(\'coords-show-mark\'), \'Hello, world!\');\n  document.body.append(message);\n  setTimeout(() => message.remove(), 5000);\n}\nfunction createMessageUnder(elem, html) {\n  // 创建 message 元素\n  let message = document.createElement(\'div\');\n  // 在这里最好使用 CSS class 来定义样式\n  message.style.cssText = "position: fixed; color: red";\n  // 分配坐标，不要忘记 "px"！\n  let coords = elem.getBoundingClientRect();\n  message.style.left = coords.left + "px";\n  message.style.top = coords.bottom + "px";\n  message.innerHTML = html;\n  return message;\n}\n')])])]),t._v(" "),n("p",[t._v("我们可以修改代码以在元素左侧，右侧或下面显示消息，也可以应用 CSS 动画来营造“淡入淡出”效果等。这很简单，因为我们有该元素所有坐标和大小。")]),t._v(" "),n("p",[t._v("但是请注意一个重要的细节：滚动页面时，消息就会从按钮流出。")]),t._v(" "),n("p",[t._v("原因很显然：message 元素依赖于 "),n("code",[t._v("position:fixed")]),t._v("，因此当页面滚动时，它仍位于窗口的同一位置。")]),t._v(" "),n("p",[t._v("要改变这一点，我们需要使用基于文档（document）的坐标和 "),n("code",[t._v("position:absolute")]),t._v(" 样式。")]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"文档坐标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文档坐标","aria-hidden":"true"}},[t._v("#")]),t._v(" 文档坐标")]),t._v(" "),n("p",[t._v("文档相对坐标从文档的左上角开始计算，而不是窗口。")]),t._v(" "),n("p",[t._v("在 CSS 中，窗口坐标对应于 "),n("code",[t._v("position:fixed")]),t._v("，而文档坐标与顶部的 "),n("code",[t._v("position:absolute")]),t._v(" 类似。")]),t._v(" "),n("p",[t._v("我们可以使用 "),n("code",[t._v("position:absolute")]),t._v(" 和 "),n("code",[t._v("top/left")]),t._v(" 来把某些内容放到文档中的某个位置，以便在页面滚动时，元素仍能保留在该位置。但是我们首先需要正确的坐标。")]),t._v(" "),n("p",[t._v("这里没有标准方法来获取元素的文档坐标。但是写起来很容易。")]),t._v(" "),n("p",[t._v("这两个坐标系统通过以下公式相连接：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("pageY")]),t._v(" = "),n("code",[t._v("clientY")]),t._v(" + 文档的垂直滚动出的部分的高度。")]),t._v(" "),n("li",[n("code",[t._v("pageX")]),t._v(" = "),n("code",[t._v("clientX")]),t._v(" + 文档的水平滚动出的部分的宽度。")])]),t._v(" "),n("p",[t._v("函数 "),n("code",[t._v("getCoords(elem)")]),t._v(" 将从 "),n("code",[t._v("elem.getBoundingClientRect()")]),t._v(" 获取窗口坐标，并向其中添加当前滚动：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取元素的文档坐标")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCoords")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("elem")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" box "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" elem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBoundingClientRect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pageYOffset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    right"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("right "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pageXOffset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    bottom"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bottom "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pageYOffset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    left"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pageXOffset\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("p",[t._v("如果在上面的示例中，我们将其与 "),n("code",[t._v("position:absolute")]),t._v(" 一起使用，则在页面滚动时，消息仍停留在元素附近。")]),t._v(" "),n("p",[t._v("修改后的 "),n("code",[t._v("createMessageUnder")]),t._v(" 函数：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createMessageUnder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("elem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" message "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cssText "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"position:absolute; color: red"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" coords "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCoords")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" coords"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" coords"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bottom "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("页面上的任何点都有坐标：")]),t._v(" "),n("ul",[n("li",[n("ol",[n("li",[t._v("相对于窗口的坐标 — "),n("code",[t._v("elem.getBoundingClientRect()")]),t._v("。")])])]),t._v(" "),n("li",[n("ol",{attrs:{start:"2"}},[n("li",[t._v("相对于文档的坐标 — "),n("code",[t._v("elem.getBoundingClientRect()")]),t._v(" 加上当前页面滚动。")])])])]),t._v(" "),n("p",[t._v("窗口坐标非常适合和 "),n("code",[t._v("position:fixed")]),t._v(" 一起使用，文档坐标非常适合和 "),n("code",[t._v("position:absolute")]),t._v(" 一起使用。")]),t._v(" "),n("p",[t._v("这两个坐标系统各有利弊。有时我们需要其中一个或另一个，就像 CSS "),n("code",[t._v("position")]),t._v(" 的 "),n("code",[t._v("absolute")]),t._v(" 和 "),n("code",[t._v("fixed")]),t._v(" 一样。")]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br")])},[],!1,null,null,null);s.default=a.exports},673:function(t,s,e){t.exports=e.p+"assets/img/document-and-window-coordinates-scrolled.e41817db.svg"},674:function(t,s,e){t.exports=e.p+"assets/img/coordinates.3795f432.svg"},675:function(t,s,e){t.exports=e.p+"assets/img/coordinates-negative.629df10a.svg"}}]);