(window.webpackJsonp=window.webpackJsonp||[]).push([[386],{1208:function(t,e,s){"use strict";s.r(e);var a=s(19),r=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"fetch-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fetch-api","aria-hidden":"true"}},[t._v("#")]),t._v(" Fetch API")]),t._v(" "),s("p",[t._v("到目前为止，我们已经对 "),s("code",[t._v("fetch")]),t._v(" 相当了解了。")]),t._v(" "),s("p",[t._v("现在让我们来看看 "),s("code",[t._v("fetch")]),t._v(" 的剩余 API，来了解它的全部本领吧。")]),t._v(" "),s("br"),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[s("strong",[t._v("请注意：")])]),t._v(" "),s("p",[t._v("请注意：这些选项 (option) 大多都很少使用。即使跳过本章，你也可以很好地使用 "),s("code",[t._v("fetch")]),t._v("。")]),t._v(" "),s("p",[t._v("但是，知道 "),s("code",[t._v("fetch")]),t._v(" 可以做什么还是很好的，所以如果需要，你可以来看看这些细节内容。")])]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("这是所有可能的 "),s("code",[t._v("fetch")]),t._v(" 选项及其默认值（注释中标注了可选值）的完整列表：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// POST，PUT，DELETE，等。")]),t._v("\n  headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 内容类型 header 值通常是自动设置的")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 取决于 request body")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/plain;charset=UTF-8"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// string，FormData，Blob，BufferSource，或 URLSearchParams")]),t._v("\n  referrer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"about:client"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 或 "" 以不发送 Referer header，')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或者是当前源的 url")]),t._v("\n  referrerPolicy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"no-referrer-when-downgrade"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// no-referrer，origin，same-origin...")]),t._v("\n  mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cors"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// same-origin，no-cors")]),t._v("\n  credentials"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"same-origin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// omit，include")]),t._v("\n  cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// no-store，reload，no-cache，force-cache，或 only-if-cached")]),t._v("\n  redirect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"follow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// manual，error")]),t._v("\n  integrity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 一个 hash，像 "sha256-abcdef1234567890"')]),t._v("\n  keepalive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// true")]),t._v("\n  signal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// AbortController 来中止请求")]),t._v("\n  window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" window "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// null")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br")])]),s("p",[t._v("一个令人印象深刻的列表，对吧?")]),t._v(" "),s("p",[t._v("我们已经在 "),s("router-link",{attrs:{to:"/learn_javascript_asdiasdkc/three/qeiwoquweiz/01/"}},[t._v("Fetch")]),t._v(" 一章中详细介绍了 "),s("code",[t._v("method")]),t._v("，"),s("code",[t._v("headers")]),t._v(" 和 "),s("code",[t._v("body")]),t._v("。")],1),t._v(" "),s("p",[t._v("在 "),s("router-link",{attrs:{to:"/learn_javascript_asdiasdkc/three/qeiwoquweiz/04/"}},[t._v("Fetch：中止（Abort）")]),t._v(" 一章中介绍了 "),s("code",[t._v("signal")]),t._v(" 选项。")],1),t._v(" "),s("p",[t._v("现在让我们学习其余的本领。")]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"referrer，referrerpolicy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#referrer，referrerpolicy","aria-hidden":"true"}},[t._v("#")]),t._v(" referrer，referrerPolicy")]),t._v(" "),s("p",[t._v("这些选项决定了 "),s("code",[t._v("fetch")]),t._v(" 如何设置 HTTP 的 "),s("code",[t._v("Referer")]),t._v(" header。")]),t._v(" "),s("p",[t._v("通常来说，这个 header 是被自动设置的，并包含了发出请求的页面的 url。在大多数情况下，它一点也不重要，但有时出于安全考虑，删除或缩短它是有意义的。")]),t._v(" "),s("br"),t._v(" "),s("p",[s("strong",[s("code",[t._v("referer")]),t._v(" 选项允许设置在当前域的任何 "),s("code",[t._v("Referer")]),t._v("，或者移除它。")])]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("要不发送 referer，可以将 "),s("code",[t._v("referer")]),t._v(" 设置为空字符串：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/page'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  referrer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 没有 Referer header")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("设置在当前域内的另一个 url：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/page'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 假设我们在 https://relieved-hai.github.io")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们可以设置任何 Referer header，但必须是在当前域内的")]),t._v("\n  referrer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://relieved-hai.github.io/notebook"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("br"),t._v(" "),s("p",[s("strong",[s("code",[t._v("referrerPolicy")]),t._v(" 选项为 "),s("code",[t._v("Referer")]),t._v(" 设置一般的规则。")])]),t._v(" "),s("p",[t._v("请求分为 3 种类型：")]),t._v(" "),s("ul",[s("li",[t._v("同源请求。")]),t._v(" "),s("li",[t._v("跨源请求。")]),t._v(" "),s("li",[t._v("从 HTTPS 到 HTTP 的请求 (从安全协议到不安全协议)。")])]),t._v(" "),s("p",[t._v("与 "),s("code",[t._v("referrer")]),t._v(" 选项允许设置确切的 "),s("code",[t._v("Referer")]),t._v(" 值不同，"),s("code",[t._v("referrerPolicy")]),t._v(" 告诉浏览器针对各个请求类型的一般的规则。")]),t._v(" "),s("p",[t._v("可能的值在 "),s("a",{attrs:{href:"https://w3c.github.io/webappsec-referrer-policy/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Referrer Policy 规范"),s("OutboundLink")],1),t._v(" 中有详细描述：")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v('"no-referrer-when-downgrade"')])]),t._v(" —— 默认值：除非我们从 HTTPS 发送请求到 HTTP（到安全性较低的协议），否则始终会发送完整的 "),s("code",[t._v("Referer")]),t._v("。")]),t._v(" "),s("li",[s("strong",[s("code",[t._v('"no-referrer"')])]),t._v(" —— 从不发送 "),s("code",[t._v("Referer")]),t._v("。")]),t._v(" "),s("li",[s("strong",[s("code",[t._v('"origin"')])]),t._v(" —— 只发送在 "),s("code",[t._v("Referer")]),t._v(" 中的域，而不是完整的页面 URL，例如，只发送 "),s("code",[t._v("http://site.com")]),t._v(" 而不是 "),s("code",[t._v("http://site.com/path")]),t._v("。")]),t._v(" "),s("li",[s("strong",[s("code",[t._v('"origin-when-cross-origin"')])]),t._v(" —— 发送完整的 "),s("code",[t._v("Referer")]),t._v(" 到相同的源，但对于跨源请求，只发送域部分（同上）。")]),t._v(" "),s("li",[s("strong",[s("code",[t._v('"same-origin"')])]),t._v(" —— 发送完整的 "),s("code",[t._v("Referer")]),t._v(" 到相同的源，但对于跨源请求，不发送 "),s("code",[t._v("Referer")]),t._v("。")]),t._v(" "),s("li",[s("strong",[s("code",[t._v('"strict-origin"')])]),t._v(" —— 仅发送源值，不发送 HTTPS → HTTP 请求的引荐来源。")]),t._v(" "),s("li",[s("strong",[s("code",[t._v('"strict-origin-when-cross-origin"')])]),t._v(" —— 对于同源情况下则发送完整的 "),s("code",[t._v("Referer")]),t._v("，对于跨源情况下，则只发送域，如果是 HTTPS → HTTP 请求，则什么都不发送。")]),t._v(" "),s("li",[s("strong",[s("code",[t._v('"unsafe-url"')])]),t._v(" —— 在 "),s("code",[t._v("Referer")]),t._v(" 中始终发送完整的 url，即使是 HTTPS → HTTP 请求。")])]),t._v(" "),s("p",[t._v("这是一个包含所有组合的表格：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("值")])]),t._v(" "),s("th",[s("strong",[t._v("同源")])]),t._v(" "),s("th",[s("strong",[t._v("跨源")])]),t._v(" "),s("th",[s("strong",[t._v("HTTPS→HTTP")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v('"no-referrer"')])]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"no-referrer-when-downgrade" 或 ""（默认）')])]),t._v(" "),s("td",[t._v("完整的 url")]),t._v(" "),s("td",[t._v("完整的 url")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"origin"')])]),t._v(" "),s("td",[t._v("仅域")]),t._v(" "),s("td",[t._v("仅域")]),t._v(" "),s("td",[t._v("仅域")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"origin-when-cross-origin"')])]),t._v(" "),s("td",[t._v("完整的 url")]),t._v(" "),s("td",[t._v("仅域")]),t._v(" "),s("td",[t._v("仅域")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"same-origin"')])]),t._v(" "),s("td",[t._v("完整的 url")]),t._v(" "),s("td",[t._v("-")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"strict-origin"')])]),t._v(" "),s("td",[t._v("仅域")]),t._v(" "),s("td",[t._v("仅域")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"strict-origin-when-cross-origin"')])]),t._v(" "),s("td",[t._v("完整的 url")]),t._v(" "),s("td",[t._v("仅域")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"unsafe-url"')])]),t._v(" "),s("td",[t._v("完整的 url")]),t._v(" "),s("td",[t._v("完整的 url")]),t._v(" "),s("td",[t._v("完整的 url")])])])]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("假如我们有一个带有 URL 结构的管理区域（admin zone），它不应该被从网站外看到。")]),t._v(" "),s("p",[t._v("如果我们发送了一个 "),s("code",[t._v("fetch")]),t._v("，则默认情况下，它总是发送带有页面完整 url 的 "),s("code",[t._v("Referer")]),t._v(" header（我们从 HTTPS 向 HTTP 发送请求的情况除外，这种情况下没有 "),s("code",[t._v("Referer")]),t._v("）。")]),t._v(" "),s("p",[t._v("例如 "),s("code",[t._v("Referer: https://relieved-hai.github.io/admin/secret/paths")]),t._v("。")]),t._v(" "),s("p",[t._v("如果我们想让其他网站只知道域的部分，而不是 URL 路径，我们可以这样设置选项：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://another.com/page'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  referrerPolicy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"origin-when-cross-origin"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Referer: https://relieved-hai.github.io")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("我们可以将其置于所有 "),s("code",[t._v("fetch")]),t._v(" 调用中，也可以将其集成到我们项目的执行所有请求并在内部使用 "),s("code",[t._v("fetch")]),t._v(" 的 JavaScript 库中。")]),t._v(" "),s("p",[t._v("与默认行为相比，它的唯一区别在于，对于跨源请求，"),s("code",[t._v("fetch")]),t._v(" 只发送 URL 域的部分（例如 "),s("code",[t._v("https://relieved-hai.github.io")]),t._v("，没有路径）。对于同源请求，我们仍然可以获得完整的 "),s("code",[t._v("Referer")]),t._v("（可能对于调试目的是有用的）。")]),t._v(" "),s("br"),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",[s("strong",[t._v("Referrer policy 不仅适用于 "),s("code",[t._v("fetch")])])]),t._v(" "),s("p",[t._v("在 "),s("a",{attrs:{href:"https://w3c.github.io/webappsec-referrer-policy/",target:"_blank",rel:"noopener noreferrer"}},[t._v("规范"),s("OutboundLink")],1),t._v(" 中描述的 referrer policy，不仅适用于 "),s("code",[t._v("fetch")]),t._v("，它还具有全局性。")]),t._v(" "),s("p",[t._v("特别是，可以使用 "),s("code",[t._v("Referrer-Policy")]),t._v(" HTTP header，或者为每个链接设置 "),s("code",[t._v('<a rel="noreferrer">')]),t._v("，来为整个页面设置默认策略（policy）。")])]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mode","aria-hidden":"true"}},[t._v("#")]),t._v(" mode")]),t._v(" "),s("p",[s("code",[t._v("mode")]),t._v(" 选项是一种安全措施，可以防止偶发的跨源请求：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v('"cors"')]),t._v(" —— 默认值，允许跨源请求，如 "),s("router-link",{attrs:{to:"/learn_javascript_asdiasdkc/three/qeiwoquweiz/05/"}},[t._v("Fetch：跨源请求")]),t._v(" 一章所述，")],1),t._v(" "),s("li",[s("code",[t._v('"same-origin"')]),t._v(" —— 禁止跨源请求，")]),t._v(" "),s("li",[s("code",[t._v('"no-cors"')]),t._v(" —— 只允许简单的跨源请求。")])]),t._v(" "),s("p",[t._v("当 "),s("code",[t._v("fetch")]),t._v(" 的 URL 来自于第三方，并且我们想要一个“断电开关”来限制跨源能力时，此选项可能很有用。")]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"credentials"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#credentials","aria-hidden":"true"}},[t._v("#")]),t._v(" credentials")]),t._v(" "),s("p",[s("code",[t._v("credentials")]),t._v(" 选项指定 "),s("code",[t._v("fetch")]),t._v(" 是否应该随请求发送 cookie 和 HTTP-Authorization header。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v('"same-origin"')]),t._v(" —— 默认值，对于跨源请求不发送，")]),t._v(" "),s("li",[s("code",[t._v('"include"')]),t._v(" —— 总是发送，需要来自跨源服务器的 "),s("code",[t._v("Accept-Control-Allow-Credentials")]),t._v("，才能使 JavaScript 能够访问响应，详细内容在 "),s("router-link",{attrs:{to:"/learn_javascript_asdiasdkc/three/qeiwoquweiz/05/"}},[t._v("Fetch：跨源请求")]),t._v(" 一章有详细介绍，")],1),t._v(" "),s("li",[s("code",[t._v('"omit"')]),t._v(" —— 不发送，即使对于同源请求。")])]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cache","aria-hidden":"true"}},[t._v("#")]),t._v(" cache")]),t._v(" "),s("p",[t._v("默认情况下，"),s("code",[t._v("fetch")]),t._v(" 请求使用标准的 HTTP 缓存。就是说，它遵从 "),s("code",[t._v("Expires")]),t._v("，"),s("code",[t._v("Cache-Control")]),t._v(" header，发送 "),s("code",[t._v("If-Modified-Since")]),t._v("，等。就像常规的 HTTP 请求那样。")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("cache")]),t._v(" 选项可以忽略 HTTP 缓存或者对其用法进行微调：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v('"default"')]),t._v(" —— "),s("code",[t._v("fetch")]),t._v(" 使用标准的 HTTP 缓存规则和 header，")]),t._v(" "),s("li",[s("code",[t._v('"no-store"')]),t._v(" —— 完全忽略 HTTP 缓存，如果我们设置 header "),s("code",[t._v("If-Modified-Since")]),t._v("，"),s("code",[t._v("If-None-Match")]),t._v("，"),s("code",[t._v("If-Unmodified-Since")]),t._v("，"),s("code",[t._v("If-Match")]),t._v("，或 "),s("code",[t._v("If-Range")]),t._v("，则此模式会成为默认模式，")]),t._v(" "),s("li",[s("code",[t._v('"reload"')]),t._v(" —— 不从 HTTP 缓存中获取结果（如果有），而是使用响应填充缓存（如果 response header 允许），")]),t._v(" "),s("li",[s("code",[t._v('"no-cache"')]),t._v(" —— 如果有一个已缓存的响应，则创建一个有条件的请求，否则创建一个普通的请求。使用响应填充 HTTP 缓存，")]),t._v(" "),s("li",[s("code",[t._v('"force-cache"')]),t._v(" —— 使用来自 HTTP 缓存的响应，即使该响应已过时（stale）。如果 HTTP 缓存中没有响应，则创建一个常规的 HTTP 请求，行为像正常那样，")]),t._v(" "),s("li",[s("code",[t._v('"only-if-cached"')]),t._v(" —— 使用来自 HTTP 缓存的响应，即使该响应已过时（stale）。如果 HTTP 缓存中没有响应，则报错。只有当 "),s("code",[t._v("mode")]),t._v(" 为 "),s("code",[t._v("same-origin")]),t._v(" 时生效。")])]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"redirect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redirect","aria-hidden":"true"}},[t._v("#")]),t._v(" redirect")]),t._v(" "),s("p",[t._v("通常来说，"),s("code",[t._v("fetch")]),t._v(" 透明地遵循 HTTP 重定向，例如 301，302 等。")]),t._v(" "),s("p",[s("code",[t._v("redirect")]),t._v(" 选项允许对此进行更改：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v('"follow"')]),t._v(" —— 默认值，遵循 HTTP 重定向，")]),t._v(" "),s("li",[s("code",[t._v('"error"')]),t._v(" —— HTTP 重定向时报错，")]),t._v(" "),s("li",[s("code",[t._v('"manual"')]),t._v(" —— 不遵循 HTTP 重定向，但 response.url 将是一个新的 URL，并且 "),s("code",[t._v("response redirectd")]),t._v(" 将为 "),s("code",[t._v("true")]),t._v("，以便我们能够手动执行重定向到新的 URL（如果需要的话）。")])]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"integrity"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#integrity","aria-hidden":"true"}},[t._v("#")]),t._v(" integrity")]),t._v(" "),s("p",[s("code",[t._v("integrity")]),t._v(" 选项允许检查响应是否与已知的预先校验和相匹配。")]),t._v(" "),s("p",[t._v("正如 "),s("a",{attrs:{href:"https://w3c.github.io/webappsec-subresource-integrity/",target:"_blank",rel:"noopener noreferrer"}},[t._v("规范"),s("OutboundLink")],1),t._v(" 所描述的，支持的哈希函数有 SHA-256，SHA-384，和 SHA-512，可能还有其他的，这取决于浏览器。")]),t._v(" "),s("p",[t._v("例如，我们下载一个文件，并且我们知道它的 SHA-256 校验和为 “abcdef”（当然，实际校验和会更长）。")]),t._v(" "),s("p",[t._v("我们可以将其放在 "),s("code",[t._v("integrity")]),t._v(" 选项中，就像这样:")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://site.com/file'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  integrity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sha256-abcdef'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("然后 "),s("code",[t._v("fetch")]),t._v(" 将自行计算 SHA-256 并将其与我们的字符串进行比较。如果不匹配，则会触发错误。")]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"keepalive"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#keepalive","aria-hidden":"true"}},[t._v("#")]),t._v(" keepalive")]),t._v(" "),s("p",[s("code",[t._v("keepalive")]),t._v(" 选项表示该请求可能会使发起它的网页“失活（outlive）”。")]),t._v(" "),s("p",[t._v("例如，我们收集有关当前访问者是如何使用我们的页面（鼠标点击，他查看的页面片段）的统计信息，以分析和改善用户体验。")]),t._v(" "),s("p",[t._v("当访问者离开我们的网页时 —— 我们希望能够将数据保存到我们的服务器上。")]),t._v(" "),s("p",[t._v("我们可以使用 "),s("code",[t._v("window.onunload")]),t._v(" 事件来实现：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onunload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/analytics'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"statistics"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    keepalive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("通常，当一个文档被卸载时（unloaded），所有相关的网络请求都会被中止。但是，"),s("code",[t._v("keepalive")]),t._v(" 选项告诉浏览器，即使在离开页面后，也要在后台执行请求。所以，此选项对于我们的请求成功至关重要。")]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("它有一些限制：")]),t._v(" "),s("ul",[s("li",[t._v("我们无法发送兆字节的数据："),s("code",[t._v("keepalive")]),t._v(" 请求的 body 限制为 64kb。\n"),s("ul",[s("li",[t._v("如果我们需要收集有关访问的大量统计信息，我们则应该将其定期以数据包的形式发送出去，这样就不会留下太多数据给最后的 "),s("code",[t._v("onunload")]),t._v(" 请求了。")]),t._v(" "),s("li",[t._v("此限制是被应用于当前所有 "),s("code",[t._v("keepalive")]),t._v(" 请求的总和的。换句话说，我们可以并行执行多个 "),s("code",[t._v("keepalive")]),t._v(" 请求，但它们的 body 长度之和不得超过 64KB。")])])]),t._v(" "),s("li",[t._v("如果文档（document）已卸载（unloaded），我们就无法处理服务器响应。因此，在我们的示例中，因为 "),s("code",[t._v("keepalive")]),t._v("，所以 "),s("code",[t._v("fetch")]),t._v(" 会成功，但是后续的函数将无法正常工作。\n"),s("ul",[s("li",[t._v("在大多数情况下，例如发送统计信息，这不是问题，因为服务器只接收数据，并通常向此类请求发送空的响应。")])])])]),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("br")])},[],!1,null,null,null);e.default=r.exports}}]);