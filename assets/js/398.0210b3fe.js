(window.webpackJsonp=window.webpackJsonp||[]).push([[398],{1042:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"file-和-filereader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-和-filereader","aria-hidden":"true"}},[t._v("#")]),t._v(" File 和 FileReader")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.w3.org/TR/FileAPI/#dfn-file",target:"_blank",rel:"noopener noreferrer"}},[t._v("File"),a("OutboundLink")],1),t._v(" 对象继承自 "),a("code",[t._v("Blob")]),t._v("，并扩展了与文件系统相关的功能。")]),t._v(" "),a("p",[t._v("有两种方式可以获取它。")]),t._v(" "),a("br"),t._v(" "),a("p",[t._v("第一种，与 "),a("code",[t._v("Blob")]),t._v(" 类似，有一个构造器：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileParts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[t._v("fileParts")])]),t._v(" —— Blob/BufferSource/String 类型值的数组。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("fileName")])]),t._v(" —— 文件名字符串。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("options")])]),t._v(" —— 可选对象：\n"),a("ul",[a("li",[a("strong",[a("code",[t._v("lastModified")])]),t._v(" —— 最后一次修改的时间戳（整数日期）。")])])])]),t._v(" "),a("br"),t._v(" "),a("p",[t._v("第二种，更常见的是，我们从 "),a("code",[t._v('<input type="file">')]),t._v(" 或拖放或其他浏览器接口来获取文件。在这种情况下，file 将从操作系统（OS）获得 this 信息。")]),t._v(" "),a("p",[t._v("由于 "),a("code",[t._v("File")]),t._v(" 是继承自 "),a("code",[t._v("Blob")]),t._v(" 的，所以 "),a("code",[t._v("File")]),t._v(" 对象具有相同的属性，附加：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("name")]),t._v(" —— 文件名，")]),t._v(" "),a("li",[a("code",[t._v("lastModified")]),t._v(" —— 最后一次修改的时间戳。")])]),t._v(" "),a("p",[t._v("这就是我们从 "),a("code",[t._v('<input type="file">')]),t._v(" 中获取 "),a("code",[t._v("File")]),t._v(" 对象的方式：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onchange")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("showFile(this)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" file "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("files"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`File name: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如 my.png")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`Last modified: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastModified"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如 1552830408824")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("br"),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",[a("strong",[t._v("请注意：")])]),t._v(" "),a("p",[t._v("输入（input）可以选择多个文件，因此 "),a("code",[t._v("input.files")]),t._v(" 是一个类数组对象。这里我们只有一个文件，所以我们只取 "),a("code",[t._v("input.files[0]")]),t._v("。")])]),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("h2",{attrs:{id:"filereader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filereader","aria-hidden":"true"}},[t._v("#")]),t._v(" FileReader")]),t._v(" "),a("p",[a("router-link",{attrs:{to:"/learn_javascript_asdiasdkc/three/yhntgbcdexsw/04/w3.org/TR/FileAPI/#dfn-filereader"}},[t._v("FileReader")]),t._v(" 是一个对象，其唯一目的是从 "),a("code",[t._v("Blob")]),t._v("（因此也从 "),a("code",[t._v("File")]),t._v("）对象中读取数据。")],1),t._v(" "),a("p",[t._v("它使用事件来传递数据，因为从磁盘读取数据可能比较费时间。")]),t._v(" "),a("br"),t._v(" "),a("p",[t._v("构造函数：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" reader "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 没有参数")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("br"),t._v(" "),a("p",[t._v("主要方法:")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("readAsArrayBuffer(blob)")])]),t._v(" —— 将数据读取为二进制格式的 "),a("code",[t._v("ArrayBuffer")]),t._v("。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("readAsText(blob, [encoding])")])]),t._v(" —— 将数据读取为给定编码（默认为 "),a("code",[t._v("utf-8")]),t._v(" 编码）的文本字符串。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("readAsDataURL(blob)")])]),t._v(" —— 读取二进制数据，并将其编码为 base64 的 data url。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("abort()")])]),t._v(" —— 取消操作。")])]),t._v(" "),a("p",[a("code",[t._v("read*")]),t._v(" 方法的选择，取决于我们喜欢哪种格式，以及如何使用数据。")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("readAsArrayBuffer")])]),t._v(" —— 用于二进制文件，执行低级别的二进制操作。对于诸如切片（slicing）之类的高级别的操作，"),a("code",[t._v("File")]),t._v(" 是继承自 "),a("code",[t._v("Blob")]),t._v(" 的，所以我们可以直接调用它们，而无需读取。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("readAsText")])]),t._v(" —— 用于文本文件，当我们想要获取字符串时。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("readAsDataURL")])]),t._v(" —— 当我们想在 "),a("code",[t._v("src")]),t._v(" 中使用此数据，并将其用于 "),a("code",[t._v("img")]),t._v(" 或其他标签时。正如我们在 "),a("router-link",{attrs:{to:"/learn_javascript_asdiasdkc/three/yhntgbcdexsw/03/"}},[t._v("Blob")]),t._v(" 一章中所讲的，还有一种用于此的读取文件的替代方案："),a("code",[t._v("URL.createObjectURL(file)")]),t._v("。")],1)]),t._v(" "),a("br"),t._v(" "),a("p",[t._v("读取过程中，有以下事件：")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("loadstart")])]),t._v(" —— 开始加载。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("progress")])]),t._v(" —— 在读取过程中出现。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("load")])]),t._v(" —— 读取完成，没有 error。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("abort")])]),t._v(" —— 调用了 "),a("code",[t._v("abort()")]),t._v("。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("error")])]),t._v(" —— 出现 error。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("loadend")])]),t._v(" —— 读取完成，无论成功还是失败。")])]),t._v(" "),a("p",[t._v("读取完成后，我们可以通过以下方式访问读取结果：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("reader.result")]),t._v(" 是结果（如果成功）")]),t._v(" "),a("li",[a("code",[t._v("reader.error")]),t._v(" 是 error（如果失败）。")])]),t._v(" "),a("p",[t._v("使用最广泛的事件无疑是 "),a("code",[t._v("load")]),t._v(" 和 "),a("code",[t._v("error")]),t._v("。")]),t._v(" "),a("br"),t._v(" "),a("p",[t._v("这是一个读取文件的示例：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onchange")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("readFile(this)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" file "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("files"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" reader "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readAsText")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])]),a("br"),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",[a("strong",[a("code",[t._v("FileReader")]),t._v(" 用于 blob")])]),t._v(" "),a("p",[t._v("正如我们在 "),a("router-link",{attrs:{to:"/learn_javascript_asdiasdkc/three/yhntgbcdexsw/03/"}},[t._v("Blob")]),t._v(" 一章中所提到的，"),a("code",[t._v("FileReader")]),t._v(" 不仅可读取文件，还可读取任何 blob。")],1),t._v(" "),a("p",[t._v("我们可以使用它将 blob 转换为其他格式：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("readAsArrayBuffer(blob)")]),t._v(" —— 转换为 "),a("code",[t._v("ArrayBuffer")]),t._v("，")]),t._v(" "),a("li",[a("code",[t._v("readAsText(blob, [encoding])")]),t._v(" —— 转换为字符串（"),a("code",[t._v("TextDecoder")]),t._v(" 的一个替代方案），")]),t._v(" "),a("li",[a("code",[t._v("readAsDataURL(blob)")]),t._v(" —— 转换为 base64 的 data url。")])])]),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",[a("strong",[t._v("在 Web Workers 中可以使用 "),a("code",[t._v("FileReaderSync")])])]),t._v(" "),a("p",[t._v("对于 Web Worker，还有一种同步的 "),a("code",[t._v("FileReader")]),t._v(" 变体，称为 "),a("a",{attrs:{href:"https://www.w3.org/TR/FileAPI/#FileReaderSync",target:"_blank",rel:"noopener noreferrer"}},[t._v("FileReaderSync"),a("OutboundLink")],1),t._v(" 。")]),t._v(" "),a("p",[t._v("它的读取方法 "),a("code",[t._v("read*")]),t._v(" 不会生成事件，但是会像常规函数那样返回一个结果。")]),t._v(" "),a("p",[t._v("不过，这仅在 Web Worker 中可用，因为在读取文件的时候，同步调用会有延迟，而在 Web Worker 中，这种延迟并不是很重要。它不会影响页面。")])]),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[a("code",[t._v("File")]),t._v(" 对象继承自 "),a("code",[t._v("Blob")]),t._v("。")]),t._v(" "),a("p",[t._v("除了 "),a("code",[t._v("Blob")]),t._v(" 方法和属性外，"),a("code",[t._v("File")]),t._v(" 对象还有 "),a("code",[t._v("name")]),t._v(" 和 "),a("code",[t._v("lastModified")]),t._v(" 属性，以及从文件系统读取的内部功能。我们通常从用户输入如 "),a("code",[t._v("<input>")]),t._v(" 或拖放事件来获取 "),a("code",[t._v("File")]),t._v(" 对象。")]),t._v(" "),a("p",[a("code",[t._v("FileReader")]),t._v(" 对象可以从文件或 blob 中读取数据，可以读取为以下三种格式：")]),t._v(" "),a("ul",[a("li",[t._v("字符串（"),a("code",[t._v("readAsText")]),t._v("）。")]),t._v(" "),a("li",[a("code",[t._v("ArrayBuffer")]),t._v("（"),a("code",[t._v("readAsArrayBuffer")]),t._v("）。")]),t._v(" "),a("li",[t._v("data url，base-64 编码（"),a("code",[t._v("readAsDataURL")]),t._v("）。")])]),t._v(" "),a("p",[t._v("但是，在很多情况下，我们不必读取文件内容。就像我们处理 blob 一样，我们可以使用 "),a("code",[t._v("URL.createObjectURL(file)")]),t._v(" 创建一个短的 url，并将其赋给 "),a("code",[t._v("<a>")]),t._v(" 或 "),a("code",[t._v("<img>")]),t._v("。这样，文件便可以下载文件或者将其呈现为图像，作为 canvas 等的一部分。")]),t._v(" "),a("p",[t._v("而且，如果我们要通过网络发送一个 "),a("code",[t._v("File")]),t._v("，那也很容易：像 "),a("code",[t._v("XMLHttpRequest")]),t._v(" 或 "),a("code",[t._v("fetch")]),t._v(" 等网络 API 本身就接受 "),a("code",[t._v("File")]),t._v(" 对象。")]),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("br")])},[],!1,null,null,null);s.default=e.exports}}]);