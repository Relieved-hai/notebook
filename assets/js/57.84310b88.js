(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{1216:function(t,s,a){"use strict";a.r(s);var n=a(19),r=Object(n.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"arraybuffer，二进制数组"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#arraybuffer，二进制数组","aria-hidden":"true"}},[t._v("#")]),t._v(" ArrayBuffer，二进制数组")]),t._v(" "),n("p",[t._v("在 Web 开发中，当我们处理文件时（创建，上传，下载），经常会遇到二进制数据。另一个典型的应用场景是图像处理。")]),t._v(" "),n("p",[t._v("这些都可以通过 JavaScript 进行处理，而且二进制操作性能更高。")]),t._v(" "),n("p",[t._v("不过，在 JavaScript 中有很多种二进制数据格式，会有点容易混淆。仅举几个例子：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("ArrayBuffer")]),t._v("，"),n("code",[t._v("Uint8Array")]),t._v("，"),n("code",[t._v("DataView")]),t._v("，"),n("code",[t._v("Blob")]),t._v("，"),n("code",[t._v("File")]),t._v(" 及其他。")])]),t._v(" "),n("p",[t._v("与其他语言相比，JavaScript 中的二进制数据是以非标准方式实现的。但是，当我们理清楚以后，一切就会变得相当简单了。")]),t._v(" "),n("br"),t._v(" "),n("p",[n("strong",[t._v("基本的二进制对象是 "),n("code",[t._v("ArrayBuffer")]),t._v(" —— 对固定长度的连续内存空间的引用。")])]),t._v(" "),n("p",[t._v("我们这样创建它：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buffer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建一个长度为 16 的 buffer")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("byteLength"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 16")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("它会分配一个 16 字节的连续内存空间，并用 0 进行预填充。")]),t._v(" "),n("br"),t._v(" "),n("div",{staticClass:"warning custom-block"},[n("p",[n("strong",[n("code",[t._v("ArrayBuffer")]),t._v(" 不是某种东西的数组")])]),t._v(" "),n("p",[t._v("让我们先澄清一个可能的误区。"),n("code",[t._v("ArrayBuffer")]),t._v(" 与 "),n("code",[t._v("Array")]),t._v(" 没有任何共同之处：")]),t._v(" "),n("ul",[n("li",[t._v("它的长度是固定的，我们无法增加或减少它的长度。")]),t._v(" "),n("li",[t._v("它正好占用了内存中的那么多空间。")]),t._v(" "),n("li",[t._v("要访问单个字节，需要另一个“视图”对象，而不是 "),n("code",[t._v("buffer[index]")]),t._v("。")])])]),t._v(" "),n("p",[n("code",[t._v("ArrayBuffer")]),t._v(" 是一个内存区域。它里面存储了什么？无从判断。只是一个原始的字节序列。")]),t._v(" "),n("br"),t._v(" "),n("p",[n("strong",[t._v("如要操作 "),n("code",[t._v("ArrayBuffer")]),t._v("，我们需要使用“视图”对象。")])]),t._v(" "),n("p",[t._v("视图对象本身并不存储任何东西。它是一副“眼镜”，透过它来解释存储在 "),n("code",[t._v("ArrayBuffer")]),t._v(" 中的字节。")]),t._v(" "),n("p",[t._v("例如：")]),t._v(" "),n("ul",[n("li",[n("strong",[n("code",[t._v("Uint8Array")])]),t._v(" —— 将 "),n("code",[t._v("ArrayBuffer")]),t._v(" 中的每个字节视为 0 到 255 之间的单个数字（每个字节是 8 位，因此只能容纳那么多）。这称为 “8 位无符号整数”。")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("Uint16Array")])]),t._v(" —— 将每 2 个字节视为一个 0 到 65535 之间的整数。这称为 “16 位无符号整数”。")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("Uint32Array")])]),t._v(" —— 将每 4 个字节视为一个 0 到 4294967295 之间的整数。这称为 “32 位无符号整数”。")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("Float64Array")])]),t._v(" —— 将每 8 个字节视为一个 5.0x10-324 到 1.8x10308 之间的浮点数。")])]),t._v(" "),n("p",[t._v("因此，一个 16 字节 "),n("code",[t._v("ArrayBuffer")]),t._v(" 中的二进制数据可以解释为 16 个“小数字”，或 8 个更大的数字（每个数字 2 个字节），或 4 个更大的数字（每个数字 4 个字节），或 2 个高精度的浮点数（每个数字 8 个字节）。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(633),alt:""}})]),t._v(" "),n("p",[n("code",[t._v("ArrayBuffer")]),t._v(" 是核心对象，是所有的基础，是原始的二进制数据。")]),t._v(" "),n("p",[t._v("但是，如果我们要写入值或遍历它，基本上几乎所有操作 —— 我们必须使用视图（view），例如：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buffer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建一个长度为 16 的 buffer")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" view "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint32Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将 buffer 视为一个 32 位整数的序列")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Uint32Array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BYTES_PER_ELEMENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每个整数 4 个字节")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4，它存储了 4 个整数")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("byteLength"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 16，字节中的大小")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 让我们写入一个值")]),t._v("\nview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 遍历值")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" num "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 123456，然后 0，0，0（一共 4 个值）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br")])]),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"typedarray"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#typedarray","aria-hidden":"true"}},[t._v("#")]),t._v(" TypedArray")]),t._v(" "),n("p",[t._v("所有这些视图（"),n("code",[t._v("Uint8Array")]),t._v("，"),n("code",[t._v("Uint32Array")]),t._v(" 等）的通用术语是 "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-typedarray-objects",target:"_blank",rel:"noopener noreferrer"}},[t._v("TypedArray"),n("OutboundLink")],1),t._v(" 。它们都享有同一组方法和属性。")]),t._v(" "),n("p",[t._v("请注意，没有名为 "),n("code",[t._v("TypedArray")]),t._v(" 的构造器，它只是表示 "),n("code",[t._v("ArrayBuffer")]),t._v(" 上的视图之一的通用总称术语："),n("code",[t._v("Int8Array")]),t._v("，"),n("code",[t._v("Uint8Array")]),t._v(" 及其他，很快就会有完整列表。")]),t._v(" "),n("p",[t._v("当你看到 "),n("code",[t._v("new TypedArray")]),t._v(" 之类的内容时，它表示 "),n("code",[t._v("new Int8Array")]),t._v("、"),n("code",[t._v("new Uint8Array")]),t._v(" 及其他中之一。")]),t._v(" "),n("p",[t._v("类型化数组的行为类似于常规数组：具有索引，并且是可迭代的。")]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("一个类型化数组的构造器（无论是 "),n("code",[t._v("Int8Array")]),t._v(" 或 "),n("code",[t._v("Float64Array")]),t._v("，都无关紧要），其行为各不相同，并且取决于参数类型。")]),t._v(" "),n("p",[t._v("参数有 5 种变体：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TypedArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("byteOffset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TypedArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TypedArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("typedArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TypedArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TypedArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("ul",[n("li",[n("ol",[n("li",[t._v("如果给定的是 "),n("code",[t._v("ArrayBuffer")]),t._v(" 参数，则会在其上创建视图。我们已经用过该语法了。")])]),t._v(" "),n("p",[t._v("可选，我们可以给定起始位置 "),n("code",[t._v("byteOffset")]),t._v("（默认为 0）以及 "),n("code",[t._v("length")]),t._v("（默认至 buffer 的末尾），这样视图将仅涵盖 "),n("code",[t._v("buffer")]),t._v(" 的一部分。")])]),t._v(" "),n("li",[n("ol",{attrs:{start:"2"}},[n("li",[t._v("如果给定的是 "),n("code",[t._v("Array")]),t._v("，或任何类数组对象，则会创建一个相同长度的类型化数组，并复制其内容。")])]),t._v(" "),n("p",[t._v("我们可以使用它来预填充数组的数据：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint8Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4，创建了相同长度的二进制数组")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1，用给定值填充了 4 个字节（无符号 8 位整数）")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])])]),t._v(" "),n("li",[n("ol",{attrs:{start:"3"}},[n("li",[t._v("如果给定的是另一个 "),n("code",[t._v("TypedArray")]),t._v("，也是如此：创建一个相同长度的类型化数组，并复制其内容。如果需要的话，数据在此过程中会被转换为新的类型。")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr16 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint16Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr8 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint8Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr16"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" arr8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" arr8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 232，试图复制 1000，但无法将 1000 放进 8 位字节中（详述见下文）。")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])])]),t._v(" "),n("li",[n("ol",{attrs:{start:"4"}},[n("li",[t._v("对于数字参数 "),n("code",[t._v("length")]),t._v(" —— 创建类型化数组以包含这么多元素。它的字节长度将是 "),n("code",[t._v("length")]),t._v(" 乘以单个 "),n("code",[t._v("TypedArray.BYTES_PER_ELEMENT")]),t._v(" 中的字节数：")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint16Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 为 4 个整数创建类型化数组")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" Uint16Array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BYTES_PER_ELEMENT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每个整数 2 个字节")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("byteLength "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 8（字节中的大小）")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])])]),t._v(" "),n("li",[n("ol",{attrs:{start:"5"}},[n("li",[t._v("不带参数的情况下，创建长度为零的类型化数组。")])])])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("我们可以直接创建一个 "),n("code",[t._v("TypedArray")]),t._v("，而无需提及 "),n("code",[t._v("ArrayBuffer")]),t._v("。但是，视图离不开底层的 "),n("code",[t._v("ArrayBuffer")]),t._v("，因此，除第一种情况（已提供 "),n("code",[t._v("ArrayBuffer")]),t._v("）外，其他所有情况都会自动创建 "),n("code",[t._v("ArrayBuffer")]),t._v("。")]),t._v(" "),n("p",[t._v("如要访问 "),n("code",[t._v("ArrayBuffer")]),t._v("，可以用以下属性：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("arr.buffer")]),t._v(" —— 引用 "),n("code",[t._v("ArrayBuffer")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("arr.byteLength")]),t._v(" —— "),n("code",[t._v("ArrayBuffer")]),t._v(" 的长度。")])]),t._v(" "),n("p",[t._v("因此，我们总是可以从一个视图转到另一个视图：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr8 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint8Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 同一数据的另一个视图")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr16 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint16Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("下面是类型化数组的列表：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("Uint8Array")]),t._v("，"),n("code",[t._v("Uint16Array")]),t._v("，"),n("code",[t._v("Uint32Array")]),t._v(" —— 用于 8、16 和 32 位的整数。\n"),n("ul",[n("li",[n("code",[t._v("Uint8ClampedArray")]),t._v(" —— 用于 8 位整数，在赋值时便“固定“其值（见下文）。")])])]),t._v(" "),n("li",[n("code",[t._v("Int8Array")]),t._v("，"),n("code",[t._v("Int16Array")]),t._v("，"),n("code",[t._v("Int32Array")]),t._v(" —— 用于有符号整数（可以为负数）。")]),t._v(" "),n("li",[n("code",[t._v("Float32Array")]),t._v("，"),n("code",[t._v("Float64Array")]),t._v(" —— 用于 32 位和 64 位的有符号浮点数。")])]),t._v(" "),n("br"),t._v(" "),n("div",{staticClass:"warning custom-block"},[n("p",[t._v("没有 "),n("code",[t._v("int8")]),t._v(" 或类似的单值类型")]),t._v(" "),n("p",[t._v("请注意，尽管有类似 "),n("code",[t._v("Int8Array")]),t._v(" 这样的名称，但 JavaScript 中并没有像 "),n("code",[t._v("int")]),t._v("，或 "),n("code",[t._v("int8")]),t._v(" 这样的单值类型。")]),t._v(" "),n("p",[t._v("这是合乎逻辑的，因为 "),n("code",[t._v("Int8Array")]),t._v(" 不是这些单值的数组，而是 "),n("code",[t._v("ArrayBuffer")]),t._v(" 上的视图。")])]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h3",{attrs:{id:"越界行为"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#越界行为","aria-hidden":"true"}},[t._v("#")]),t._v(" 越界行为")]),t._v(" "),n("p",[t._v("如果我们尝试将越界值写入类型化数组会出现什么情况？不会报错。但是多余的位被切除。")]),t._v(" "),n("p",[t._v("例如，我们尝试将 256 放入 "),n("code",[t._v("Uint8Array")]),t._v("。256 的二进制格式是 "),n("code",[t._v("100000000")]),t._v("（9 位），但 "),n("code",[t._v("Uint8Array")]),t._v(" 每个值只有 8 位，因此可用范围为 0 到 255。")]),t._v(" "),n("p",[t._v("对于更大的数字，仅存储最右边的（低位有效）8 位，其余部分被切除：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(634),alt:""}})]),t._v(" "),n("p",[t._v("因此结果是 0。")]),t._v(" "),n("p",[t._v("257 的二进制格式是 "),n("code",[t._v("100000001")]),t._v("（9 位），最右边的 8 位会被存储，因此数组中会有 "),n("code",[t._v("1")]),t._v("：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(635),alt:""}})]),t._v(" "),n("p",[t._v("换句话说，该数字对 2^8 取模的结果被保存了下来。")]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("示例如下：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" uint8array "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint8Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" num "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 100000000（二进制表示）")]),t._v("\n\nuint8array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nuint8array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("257")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uint8array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uint8array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("p",[n("code",[t._v("Uint8ClampedArray")]),t._v(" 在这方面比较特殊，它的表现不太一样。对于大于 255 的任何数字，它将保存为 255，对于任何负数，它将保存为 0。此行为对于图像处理很有用。")]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"typedarray-方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#typedarray-方法","aria-hidden":"true"}},[t._v("#")]),t._v(" TypedArray 方法")]),t._v(" "),n("p",[n("code",[t._v("TypedArray")]),t._v(" 具有常规的 "),n("code",[t._v("Array")]),t._v(" 方法，但有个明显的例外。")]),t._v(" "),n("p",[t._v("我们可以遍历（iterate），"),n("code",[t._v("map")]),t._v("，"),n("code",[t._v("slice")]),t._v("，"),n("code",[t._v("find")]),t._v(" 和 "),n("code",[t._v("reduce")]),t._v(" 等。")]),t._v(" "),n("p",[t._v("但有几件事我们做不了：")]),t._v(" "),n("ul",[n("li",[t._v("没有 "),n("code",[t._v("splice")]),t._v(" —— 我们无法“删除”一个值，因为类型化数组是缓冲区（buffer）上的视图，并且缓冲区（buffer）是固定的、连续的内存区域。我们所能做的就是分配一个零值。")]),t._v(" "),n("li",[t._v("无 "),n("code",[t._v("concat")]),t._v(" 方法。")])]),t._v(" "),n("p",[t._v("还有两种其他方法：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("arr.set(fromArr, [offset])")]),t._v(" 从 "),n("code",[t._v("offset")]),t._v("（默认为 0）开始，将 "),n("code",[t._v("fromArr")]),t._v(" 中的所有元素复制到 "),n("code",[t._v("arr")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("arr.subarray([begin, end])")]),t._v(" 创建一个从 "),n("code",[t._v("begin")]),t._v(" 到 "),n("code",[t._v("end")]),t._v("（不包括）相同类型的新视图。这类似于 "),n("code",[t._v("slice")]),t._v(" 方法（同样也支持），但不复制任何内容 —— 只是创建一个新视图，以对给定片段的数据进行操作。")])]),t._v(" "),n("p",[t._v("有了这些方法，我们可以复制、混合类型化数组，从现有数组创建新数组等。")]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"dataview"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dataview","aria-hidden":"true"}},[t._v("#")]),t._v(" DataView")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/DataView",target:"_blank",rel:"noopener noreferrer"}},[t._v("DataView"),n("OutboundLink")],1),t._v(" 是在 "),n("code",[t._v("ArrayBuffer")]),t._v(" 上的一种特殊的超灵活“未类型化”视图。它允许以任何格式访问任何偏移量（offset）的数据。")]),t._v(" "),n("ul",[n("li",[t._v("对于类型化的数组，构造器决定了其格式。整个数组应该是统一的。第 i 个数字是 "),n("code",[t._v("arr[i]")]),t._v("。")]),t._v(" "),n("li",[t._v("通过 "),n("code",[t._v("DataView")]),t._v("，我们可以使用 "),n("code",[t._v(".getUint8(i)")]),t._v(" 或 "),n("code",[t._v(".getUint16(i)")]),t._v(" 之类的方法访问数据。我们在调用方法时选择格式，而不是在构造的时候。")])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("语法：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("byteOffset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("byteLength"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[n("code",[t._v("buffer")])]),t._v(" —— 底层的 "),n("code",[t._v("ArrayBuffer")]),t._v("。与类型化数组不同，"),n("code",[t._v("DataView")]),t._v(" 不会自行创建缓冲区（buffer）。我们需要事先准备好。")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("byteOffset")])]),t._v(" —— 视图的起始字节位置（默认为 0）。")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("byteLength")])]),t._v(" —— 视图的字节长度（默认至 "),n("code",[t._v("buffer")]),t._v(" 的末尾）。")])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("例如，这里我们从同一个 buffer 中提取不同格式的数字：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4 个字节的二进制数组，每个都是最大值 255")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buffer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint8Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" dataView "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在偏移量为 0 处获取 8 位数字")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" dataView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUint8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 255")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 现在在偏移量为 0 处获取 16 位数字，它由 2 个字节组成，一起解析为 65535")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" dataView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUint16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 65535（最大的 16 位无符号整数）")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在偏移量为 0 处获取 32 位数字")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" dataView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUint32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4294967295（最大的 32 位无符号整数）")]),t._v("\n\ndataView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUint32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将 4 个字节的数字设为 0，即将所有字节都设为 0")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br")])]),n("p",[t._v("当我们将混合格式的数据存储在同一缓冲区（buffer）中时，"),n("code",[t._v("DataView")]),t._v(" 非常有用。例如，当我们存储一个成对序列（16 位整数，32 位浮点数）时，用 "),n("code",[t._v("DataView")]),t._v(" 可以轻松访问它们。")]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[n("code",[t._v("ArrayBuffer")]),t._v(" 是核心对象，是对固定长度的连续内存区域的引用。")]),t._v(" "),n("p",[t._v("几乎任何对 "),n("code",[t._v("ArrayBuffer")]),t._v(" 的操作，都需要一个视图。")]),t._v(" "),n("ul",[n("li",[t._v("它可以是 "),n("code",[t._v("TypedArray")]),t._v("：\n"),n("ul",[n("li",[n("code",[t._v("Uint8Array")]),t._v("，"),n("code",[t._v("Uint16Array")]),t._v("，"),n("code",[t._v("Uint32Array")]),t._v(" —— 用于 8 位、16 位和 32 位无符号整数。")]),t._v(" "),n("li",[n("code",[t._v("Uint8ClampedArray")]),t._v(" —— 用于 8 位整数，在赋值时便“固定”其值。")]),t._v(" "),n("li",[n("code",[t._v("Int8Array")]),t._v("，"),n("code",[t._v("Int16Array")]),t._v("，"),n("code",[t._v("Int32Array")]),t._v(" —— 用于有符号整数（可以为负数）。")]),t._v(" "),n("li",[n("code",[t._v("Float32Array")]),t._v("，"),n("code",[t._v("Float64Array")]),t._v(" —— 用于 32 位和 64 位的有符号浮点数。")])])]),t._v(" "),n("li",[t._v("或 "),n("code",[t._v("DataView")]),t._v(" —— 使用方法来指定格式的视图，例如，"),n("code",[t._v("getUint8(offset)")]),t._v("。")])]),t._v(" "),n("p",[t._v("在大多数情况下，我们直接对类型化数组进行创建和操作，而将 "),n("code",[t._v("ArrayBuffer")]),t._v(" 作为“通用标识符（common discriminator）”隐藏起来。我们可以通过 "),n("code",[t._v(".buffer")]),t._v(" 来访问它，并在需要时创建另一个视图。")]),t._v(" "),n("p",[t._v("还有另外两个术语，用于对二进制数据进行操作的方法的描述：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("ArrayBufferView")]),t._v(" 是所有这些视图的总称。")]),t._v(" "),n("li",[n("code",[t._v("BufferSource")]),t._v(" 是 "),n("code",[t._v("ArrayBuffer")]),t._v(" 或 "),n("code",[t._v("ArrayBufferView")]),t._v(" 的总称。")])]),t._v(" "),n("p",[t._v("我们将在下一章中学习这些术语。"),n("code",[t._v("BufferSource")]),t._v(" 是最常用的术语之一，因为它的意思是“任何类型的二进制数据” —— "),n("code",[t._v("ArrayBuffer")]),t._v(" 或其上的视图。")]),t._v(" "),n("p",[t._v("这是一份备忘单：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(636),alt:""}})]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("br")])},[],!1,null,null,null);s.default=r.exports},633:function(t,s,a){t.exports=a.p+"assets/img/arraybuffer-views.c0cb7d4b.svg"},634:function(t,s,a){t.exports=a.p+"assets/img/8bit-integer-256.563e172f.svg"},635:function(t,s,a){t.exports=a.p+"assets/img/8bit-integer-257.18c2e5d8.svg"},636:function(t,s,a){t.exports=a.p+"assets/img/arraybuffer-view-buffersource.3cab88b6.svg"}}]);