(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{1278:function(s,t,a){"use strict";a.r(t);var e=a(19),n=Object(e.a)({},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"cookie，document-cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie，document-cookie","aria-hidden":"true"}},[s._v("#")]),s._v(" Cookie，document.cookie")]),s._v(" "),e("p",[s._v("Cookie 是直接存储在浏览器中的一小串数据。它们是 HTTP 协议的一部分，由 "),e("a",{attrs:{href:"https://tools.ietf.org/html/rfc6265",target:"_blank",rel:"noopener noreferrer"}},[s._v("RFC 6265"),e("OutboundLink")],1),s._v(" 规范定义。")]),s._v(" "),e("p",[s._v("Cookie 通常是由 Web 服务器使用响应 "),e("code",[s._v("Set-Cookie")]),s._v(" HTTP-header 设置的。然后浏览器使用 "),e("code",[s._v("Cookie")]),s._v(" HTTP-header 将它们自动添加到（几乎）每个对相同域的请求中。")]),s._v(" "),e("p",[s._v("最常见的用处之一就是身份验证：")]),s._v(" "),e("ul",[e("li",[e("ol",[e("li",[s._v("登录后，服务器在响应中使用 "),e("code",[s._v("Set-Cookie")]),s._v(" HTTP-header 来设置具有唯一“会话标识符（session identifier）”的 cookie。")])])]),s._v(" "),e("li",[e("ol",{attrs:{start:"2"}},[e("li",[s._v("下次如果请求是由相同域发起的，浏览器会使用 "),e("code",[s._v("Cookie")]),s._v(" HTTP-header 通过网络发送 cookie。")])])]),s._v(" "),e("li",[e("ol",{attrs:{start:"3"}},[e("li",[s._v("所以服务器知道是谁发起了请求。")])])])]),s._v(" "),e("p",[s._v("我们还可以使用 "),e("code",[s._v("document.cookie")]),s._v(" 属性从浏览器访问 cookie。")]),s._v(" "),e("p",[s._v("关于 cookie 及其选项，有很多棘手的事情。在本章中，我们将详细介绍它们。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"从-document-cookie-中读取"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从-document-cookie-中读取","aria-hidden":"true"}},[s._v("#")]),s._v(" 从 document.cookie 中读取")]),s._v(" "),e("p",[s._v("你的浏览器是否存储了本网站的任何 cookie？让我们来看看：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 所以应该存在一些 cookie")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// cookie1=value1; cookie2=value2;...")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("code",[s._v("document.cookie")]),s._v(" 的值由 "),e("code",[s._v("name=value")]),s._v(" 对组成，以 "),e("code",[s._v(";")]),s._v(" 分隔。每一个都是独立的 cookie。")]),s._v(" "),e("p",[s._v("为了找到一个特定的 cookie，我们可以以 "),e("code",[s._v(";")]),s._v(" 作为分隔，将 "),e("code",[s._v("document.cookie")]),s._v(" 分开，然后找到对应的名字。我们可以使用正则表达式或者数组函数来实现。")]),s._v(" "),e("p",[s._v("我们把这个留给读者当作练习。此外，在本章的最后，你可以找到一些操作 cookie 的辅助函数。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"写入-document-cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#写入-document-cookie","aria-hidden":"true"}},[s._v("#")]),s._v(" 写入 document.cookie")]),s._v(" "),e("p",[s._v("我们可以写入 "),e("code",[s._v("document.cookie")]),s._v("。但这不是一个数据属性，它是一个访问器（getter/setter）。对其的赋值操作会被特殊处理。")]),s._v(" "),e("p",[e("strong",[s._v("对 "),e("code",[s._v("document.cookie")]),s._v(" 的写入操作只会更新其中提到的 cookie，而不会涉及其他 cookie。")])]),s._v(" "),e("p",[s._v("例如，此调用设置了一个名称为 "),e("code",[s._v("user")]),s._v(" 且值为 "),e("code",[s._v("John")]),s._v(" 的 cookie：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[s._v("document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user=John"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只会更新名称为 user 的 cookie")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 展示所有 cookie")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("如果你运行了上面这段代码，你会看到多个 cookie。这是因为 "),e("code",[s._v("document.cookie=")]),s._v(" 操作不是重写整所有 cookie。它只设置代码中提到的 cookie "),e("code",[s._v("user")]),s._v("。")]),s._v(" "),e("p",[s._v("从技术上讲，cookie 的名称和值可以是任何字符，为了保持有效的格式，它们应该使用内建的 "),e("code",[s._v("encodeURIComponent")]),s._v(" 函数对其进行转义：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 特殊字符（空格），需要编码")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" name "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my name"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" value "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"John Smith"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 将 cookie 编码为 my%20name=John%20Smith")]),s._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("encodeURIComponent")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'='")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("encodeURIComponent")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...; my%20name=John%20Smith")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("br"),s._v(" "),e("div",{staticClass:"warning custom-block"},[e("p",[e("strong",[s._v("限制")])]),s._v(" "),e("p",[s._v("存在一些限制：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("encodeURIComponent")]),s._v(" 编码后的 "),e("code",[s._v("name=value")]),s._v(" 对，大小不能超过 4KB。因此，我们不能在一个 cookie 中保存大的东西。")]),s._v(" "),e("li",[s._v("每个域的 cookie 总数不得超过 20+ 左右，具体限制取决于浏览器。")])])]),s._v(" "),e("br"),s._v(" "),e("p",[s._v("Cookie 有几个选项，其中很多都很重要，应该设置它。")]),s._v(" "),e("p",[s._v("选项被列在 "),e("code",[s._v("key=value")]),s._v(" 之后，以 "),e("code",[s._v(";")]),s._v(" 分隔，像这样：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[s._v("document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user=John; path=/; expires=Tue, 19 Jan 2038 03:14:07 GMT"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"path"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#path","aria-hidden":"true"}},[s._v("#")]),s._v(" path")]),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("path=/mypath")])])])]),s._v(" "),e("p",[s._v("url 路径前缀，该路径下的页面可以访问该 cookie。必须是绝对路径。默认为当前路径。")]),s._v(" "),e("p",[s._v("如果一个 cookie 带有 "),e("code",[s._v("path=/admin")]),s._v(" 设置，那么该 cookie 在 "),e("code",[s._v("/admin")]),s._v(" 和 "),e("code",[s._v("/admin/something")]),s._v(" 下都是可见的，但是在 "),e("code",[s._v("/home")]),s._v(" 或 "),e("code",[s._v("/adminpage")]),s._v(" 下不可见。")]),s._v(" "),e("p",[s._v("通常，我们应该将 "),e("code",[s._v("path")]),s._v(" 设置为根目录："),e("code",[s._v("path=/")]),s._v("，以使 cookie 对此网站的所有页面可见。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"domain"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#domain","aria-hidden":"true"}},[s._v("#")]),s._v(" domain")]),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("domain=site.com")])])])]),s._v(" "),e("p",[s._v("可访问 cookie 的域。但是在实际中，有一些限制。我们无法设置任何域。")]),s._v(" "),e("p",[s._v("默认情况下，cookie 只有在设置的域下才能被访问到。所以，如果 cookie 设置在 "),e("code",[s._v("site.com")]),s._v(" 下，我们在 "),e("code",[s._v("other.com")]),s._v(" 下就无法获取它。")]),s._v(" "),e("p",[s._v("……但是棘手的是，我们在子域 "),e("code",[s._v("forum.site.com")]),s._v(" 下也无法获取它！")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在 site.com")]),s._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user=John"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在 forum.site.com")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 没有 user")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("br"),s._v(" "),e("p",[e("strong",[s._v("无法使 cookie 可以被从另一个二级域访问，因此，"),e("code",[s._v("other.com")]),s._v(" 将永远不会收到设置在 "),e("code",[s._v("site.com")]),s._v(" 的 cookie。")])]),s._v(" "),e("br"),s._v(" "),e("p",[s._v("这是一项安全限制，为了允许我们可以将敏感信息保存在 cookie 中。")]),s._v(" "),e("p",[s._v("……但是，如果我们想要批准像 "),e("code",[s._v("forum.site.com")]),s._v(" 这样的子域访问 cookie，这是可以做到的。当我们设置一个在 "),e("code",[s._v("site.com")]),s._v(" 的 cookie 时，我们应该将 "),e("code",[s._v("domain")]),s._v(" 选项显式地设置为根域："),e("code",[s._v("domain=site.com")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在 site.com")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使 cookie 可以被在任何子域 *.site.com 访问：")]),s._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user=John; domain=site.com"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 之后")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在 forum.site.com")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 有 cookie user=John")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("出于历史原因，"),e("code",[s._v("domain=.site.com")]),s._v("（"),e("code",[s._v("site.com")]),s._v(" 前面有一个点符号）也以相同的方式工作，允许从子域访问 cookie。这是一个旧的表示法，如果我们需要支持非常旧的浏览器，则应该使用它。")]),s._v(" "),e("p",[s._v("所以，"),e("code",[s._v("domain")]),s._v(" 选项允许设置一个可以在子域访问的 cookie。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"expires，max-age"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expires，max-age","aria-hidden":"true"}},[s._v("#")]),s._v(" expires，max-age")]),s._v(" "),e("p",[s._v('默认情况下，如果一个 cookie 没有设置这两个参数中的任何一个，那么在关闭浏览器之后，它就会消失。此类 cookie 被称为 "session cookie”。')]),s._v(" "),e("p",[s._v("为了让 cookie 在浏览器关闭后仍然存在，我们可以设置 "),e("code",[s._v("expires")]),s._v(" 或 "),e("code",[s._v("max-age")]),s._v(" 选项中的一个。")]),s._v(" "),e("br"),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("expires=Tue, 19 Jan 2038 03:14:07 GMT")])])])]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间 +1 天")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" date "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Date"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400e3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndate "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" date"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("toUTCString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user=John; expires="')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" date"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("如果我们将 "),e("code",[s._v("expires")]),s._v(" 设置为过去的时间，则 cookie 会被删除。")]),s._v(" "),e("br"),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("max-age=3600")])])])]),s._v(" "),e("p",[e("code",[s._v("expires")]),s._v(" 的替代选项，具指明 cookie 的过期时间距离当前时间的秒数。")]),s._v(" "),e("p",[s._v("如果为 0 或负数，则 cookie 会被删除：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// cookie 会在一小时后失效")]),s._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user=John; max-age=3600"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 删除 cookie（让它立即过期）")]),s._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user=John; max-age=0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"secure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#secure","aria-hidden":"true"}},[s._v("#")]),s._v(" secure")]),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("secure")])])])]),s._v(" "),e("p",[s._v("Cookie 应只能被通过 HTTPS 传输。")]),s._v(" "),e("p",[e("strong",[s._v("默认情况下，如果我们在 "),e("code",[s._v("http://site.com")]),s._v(" 上设置了 cookie，那么该 cookie 也会出现在 "),e("code",[s._v("https://site.com")]),s._v(" 上，反之亦然。")])]),s._v(" "),e("p",[s._v("也就是说，cookie 是基于域的，它们不区分协议。")]),s._v(" "),e("p",[s._v("使用此选项，如果一个 cookie 是通过 "),e("code",[s._v("https://site.com")]),s._v(" 设置的，那么它不会在相同域的 HTTP 环境下出现，例如 "),e("code",[s._v("http://site.com")]),s._v("。所以，如果一个 cookie 包含绝不应该通过未加密的 HTTP 协议发送的敏感内容，那么就应该设置这个选项。")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 假设我们现在在 HTTPS 环境下")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置 cookie secure（只在 HTTPS 环境下可访问）")]),s._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user=John; secure"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"samesite"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#samesite","aria-hidden":"true"}},[s._v("#")]),s._v(" samesite")]),s._v(" "),e("p",[s._v("这是另外一个关于安全的特性。它旨在防止 XSRF（跨网站请求伪造）攻击。")]),s._v(" "),e("p",[s._v("为了了解它是如何工作的，以及何时有用，让我们看一下 XSRF 攻击。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h3",{attrs:{id:"xsrf-攻击"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xsrf-攻击","aria-hidden":"true"}},[s._v("#")]),s._v(" XSRF 攻击")]),s._v(" "),e("p",[s._v("想象一下，你登录了 "),e("code",[s._v("bank.com")]),s._v(" 网站。此时：你有了来自该网站的身份验证 cookie。你的浏览器会在每次请求时将其发送到 "),e("code",[s._v("bank.com")]),s._v("，以便识别你，并执行所有敏感的财务上的操作。")]),s._v(" "),e("p",[s._v("现在，在另外一个窗口中浏览网页时，你不小心访问了另一个网站 "),e("code",[s._v("evil.com")]),s._v("。该网站具有向 "),e("code",[s._v("bank.com")]),s._v(" 网站提交一个具有启动与黑客账户交易的字段的表单 "),e("code",[s._v('<form action="https://bank.com/pay">')]),s._v(" 的 JavaScript 代码。")]),s._v(" "),e("p",[s._v("你每次访问 "),e("code",[s._v("bank.com")]),s._v(" 时，浏览器都会发送 cookie，即使该表单是从 "),e("code",[s._v("evil.com")]),s._v(" 提交过来的。因此，银行会识别你的身份，并执行真实的付款。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(701),alt:""}})]),s._v(" "),e("p",[s._v("这就是“跨网站请求伪造（Cross-Site Request Forgery，简称 XSRF）”攻击。")]),s._v(" "),e("p",[s._v("当然，实际的银行会防止出现这种情况。所有由 "),e("code",[s._v("bank.com")]),s._v(" 生成的表单都具有一个特殊的字段，即所谓的 “XSRF 保护 token”，恶意页面既不能生成，也不能从远程页面提取它（它可以在那里提交表单，但是无法获取数据）。并且，网站 "),e("code",[s._v("bank.com")]),s._v(" 会对收到的每个表单都进行这种 token 的检查。")]),s._v(" "),e("p",[s._v("但是，实现这种防护需要花费时间：我们需要确保每个表单都具有 token 字段，并且还必须检查所有请求。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h3",{attrs:{id:"输入-cookie-samesite-选项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输入-cookie-samesite-选项","aria-hidden":"true"}},[s._v("#")]),s._v(" 输入 cookie samesite 选项")]),s._v(" "),e("p",[s._v("Cookie 的 "),e("code",[s._v("samesite")]),s._v(" 选项提供了另一种防止此类攻击的方式，（理论上）不需要要求 “XSRF 保护 token”。")]),s._v(" "),e("p",[s._v("它有两个可能的值：")]),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("samesite=strict")]),s._v("（和没有值的 "),e("code",[s._v("samesite")]),s._v(" 一样)")])])]),s._v(" "),e("p",[s._v("如果用户来自同一网站之外，那么设置了 "),e("code",[s._v("samesite=strict")]),s._v(" 的 cookie 永远不会被发送。")]),s._v(" "),e("p",[s._v("换句话说，无论用户是通过邮件链接还是从 "),e("code",[s._v("evil.com")]),s._v(" 提交表单，或者进行了任何来自其他域下的操作，cookie 都不会被发送。")]),s._v(" "),e("p",[s._v("如果身份验证 cookie 具有 "),e("code",[s._v("samesite")]),s._v(" 选项，那么 XSRF 攻击是没有机会成功的，因为来自 "),e("code",[s._v("evil.com")]),s._v(" 的提交没有 cookie。因此，"),e("code",[s._v("bank.com")]),s._v(" 将无法识别用户，也就不会继续进行付款。")]),s._v(" "),e("p",[s._v("这种保护是相当可靠的。只有来自 "),e("code",[s._v("bank.com")]),s._v(" 的操作才会发送 "),e("code",[s._v("samesite")]),s._v(" cookie，例如来自 "),e("code",[s._v("bank.com")]),s._v(" 的另一页面的表单提交。")]),s._v(" "),e("br"),s._v(" "),e("p",[s._v("虽然，这样有一些不方便。")]),s._v(" "),e("p",[s._v("当用户通过合法的链接访问 "),e("code",[s._v("bank.com")]),s._v(" 时，例如从他们自己的笔记，他们会感到惊讶，"),e("code",[s._v("bank.com")]),s._v(" 无法识别他们的身份。实际上，在这种情况下不会发送 "),e("code",[s._v("samesite=strict")]),s._v(" cookie。")]),s._v(" "),e("p",[s._v("我们可以通过使用两个 cookie 来解决这个问题：一个 cookie 用于“一般识别”，仅用于说 “Hello, John”，另一个带有 "),e("code",[s._v("samesite=strict")]),s._v(" 的 cookie 用于进行数据更改的操作。这样，从网站外部来的用户会看到欢迎信息，但是支付操作必须是从银行网站启动的，这样第二个 cookie 才能被发送。")]),s._v(" "),e("br"),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("samesite=lax")])])])]),s._v(" "),e("p",[s._v("一种更轻松的方法，该方法还可以防止 XSRF 攻击，并且不会破坏用户体验。")]),s._v(" "),e("p",[s._v("宽松（lax）模式，和 "),e("code",[s._v("strict")]),s._v(" 模式类似，当从外部来到网站，则禁止浏览器发送 cookie，但是增加了一个例外。")]),s._v(" "),e("p",[s._v("如果以下两个条件均成立，则会发送 "),e("code",[s._v("samesite=lax")]),s._v(" cookie：")]),s._v(" "),e("ul",[e("li",[e("ol",[e("li",[s._v("HTTP 方法是“安全的”（例如 GET 方法，而不是 POST）。")])]),s._v(" "),e("p",[s._v("所有安全的 HTTP 方法详见 "),e("a",{attrs:{href:"https://tools.ietf.org/html/rfc7231",target:"_blank",rel:"noopener noreferrer"}},[s._v("RFC7231 规范"),e("OutboundLink")],1),s._v("。基本上，这些都是用于读取而不是写入数据的方法。它们不得执行任何更改数据的操作。跟随链接始终是 GET，是安全的方法。")])]),s._v(" "),e("li",[e("ol",{attrs:{start:"2"}},[e("li",[s._v("该操作执行顶级导航（更改浏览器地址栏中的 URL）。")])]),s._v(" "),e("p",[s._v("这通常是成立的，但是如果导航是在一个 "),e("code",[s._v("<iframe>")]),s._v(" 中执行的，那么它就不是顶级的。此外，用于网络请求的 JavaScript 方法不会执行任何导航，因此它们不适合。")])])]),s._v(" "),e("p",[s._v("所以，"),e("code",[s._v("samesite=lax")]),s._v(" 所做的是基本上允许最常见的“去往 URL”操作具有 cookie。例如，从笔记本中打开网站链接就满足这些条件。")]),s._v(" "),e("p",[s._v("但是，任何更复杂的事儿，例如来自另一个网站的网络请求或表单提交都会丢失 cookie。")]),s._v(" "),e("p",[s._v("如果这种情况适合你，那么添加 "),e("code",[s._v("samesite=lax")]),s._v(" 将不会破坏用户体验并且可以增加保护。")]),s._v(" "),e("p",[s._v("总体而言，"),e("code",[s._v("samesite")]),s._v(" 是一个很好的选项，但是它有一个重要的缺点：")]),s._v(" "),e("p",[e("em",[e("code",[s._v("samesite")]),s._v(" 会被到 2017 年左右的旧版本浏览器忽略（不兼容）。")])]),s._v(" "),e("p",[e("strong",[s._v("因此，如果我们仅依靠 "),e("code",[s._v("samesite")]),s._v(" 提供保护，那么在旧版本的浏览器上将很容易受到攻击。")])]),s._v(" "),e("p",[s._v("但是，我们肯定可以将 "),e("code",[s._v("samesite")]),s._v(" 与其他保护措施（例如 XSRF token）一起使用，例如 xsrf token，这样可以多增加一层保护，将来，当旧版本的浏览器淘汰时，我们可能就可以删除 xsrf token 这种方式了。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"httponly"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#httponly","aria-hidden":"true"}},[s._v("#")]),s._v(" httpOnly")]),s._v(" "),e("p",[s._v("这个选项和 JavaScript 没有关系，但是我们必须为了完整性也提一下它。")]),s._v(" "),e("p",[s._v("Web 服务器使用 "),e("code",[s._v("Set-Cookie")]),s._v(" header 来设置 cookie。并且，它可以设置 "),e("code",[s._v("httpOnly")]),s._v(" 选项。")]),s._v(" "),e("p",[s._v("这个选项禁止任何 JavaScript 访问 cookie。我们使用 "),e("code",[s._v("document.cookie")]),s._v(" 看不到此类 cookie，也无法对此类 cookie 进行操作。")]),s._v(" "),e("p",[s._v("这是一种预防措施，当黑客将自己的 JavaScript 代码注入网页，并等待用户访问该页面时发起攻击，而这个选项可以防止此时的这种攻击。这应该是不可能发生的，黑客应该无法将他们的代码注入我们的网站，但是网站有可能存在 bug，使得黑客能够实现这样的操作。")]),s._v(" "),e("p",[s._v("通常来说，如果发生了这种情况，并且用户访问了带有黑客 JavaScript 代码的页面，黑客代码将执行并通过 "),e("code",[s._v("document.cookie")]),s._v(" 获取到包含用户身份验证信息的 cookie。这就很糟糕了。")]),s._v(" "),e("p",[s._v("但是，如果 cookie 设置了 "),e("code",[s._v("httpOnly")]),s._v("，那么 "),e("code",[s._v("document.cookie")]),s._v(" 则看不到 cookie，所以它受到了保护。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"附录-cookie-函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附录-cookie-函数","aria-hidden":"true"}},[s._v("#")]),s._v(" 附录: Cookie 函数")]),s._v(" "),e("p",[s._v("这里有一组有关 cookie 操作的函数，比手动修改 "),e("code",[s._v("document.cookie")]),s._v(" 方便得多。")]),s._v(" "),e("p",[s._v("有很多这种 cookie 库，所以这些函数只用于演示。虽然它们都能正常使用。")]),s._v(" "),e("br"),s._v(" "),e("h3",{attrs:{id:"getcookie-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getcookie-name","aria-hidden":"true"}},[s._v("#")]),s._v(" getCookie(name)")]),s._v(" "),e("p",[s._v("获取 cookie 最简短的方式是使用 "),e("router-link",{attrs:{to:"/learn_javascript_asdiasdkc/three/ioprtymcvzq/01/"}},[s._v("正则表达式")]),s._v("。")],1),s._v(" "),e("p",[e("code",[s._v("getCookie(name)")]),s._v(" 函数返回具有给定 "),e("code",[s._v("name")]),s._v(" 的 cookie：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 返回具有给定 name 的 cookie，")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果没找到，则返回 undefined")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCookie")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" matches "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("match")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RegExp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(?:^|; )"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("replace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token regex"}},[s._v("/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\\\$1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"=([^;]*)"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" matches "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("decodeURIComponent")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("matches"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("这里的 "),e("code",[s._v("new RegExp")]),s._v(" 是动态生成的，以匹配 ; "),e("code",[s._v("name=<value>")]),s._v("。")]),s._v(" "),e("p",[s._v("请注意 cookie 的值是经过编码的，所以 "),e("code",[s._v("getCookie")]),s._v(" 使用了内建方法 "),e("code",[s._v("decodeURIComponent")]),s._v(" 函数对其进行解码。")]),s._v(" "),e("br"),s._v(" "),e("h3",{attrs:{id:"setcookie-name-value-options"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setcookie-name-value-options","aria-hidden":"true"}},[s._v("#")]),s._v(" setCookie(name, value, options)")]),s._v(" "),e("p",[s._v("将 cookie "),e("code",[s._v("name")]),s._v(" 设置为具有默认值 "),e("code",[s._v("path=/")]),s._v("（可以修改以添加其他默认值）和给定值 "),e("code",[s._v("value")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCookie")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n  options "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果需要，可以在这里添加其他默认值")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("options\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expires "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expires "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expires"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("toUTCString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" updatedCookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("encodeURIComponent")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"="')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("encodeURIComponent")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" optionKey "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    updatedCookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"; "')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" optionKey"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" optionValue "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("optionKey"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("optionValue "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      updatedCookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"="')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" optionValue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" updatedCookie"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用范例：")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCookie")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'John'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("secure"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'max-age'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("br"),s._v(" "),e("h3",{attrs:{id:"deletecookie-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deletecookie-name","aria-hidden":"true"}},[s._v("#")]),s._v(" deleteCookie(name)")]),s._v(" "),e("p",[s._v("要删除一个 cookie，我们可以给它设置一个负的过期时间来调用它：")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("deleteCookie")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCookie")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'max-age'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("br"),s._v(" "),e("div",{staticClass:"warning custom-block"},[e("p",[e("strong",[s._v("更新或删除必须使用相同的路径和域")])]),s._v(" "),e("p",[s._v("请注意：当我们更新或删除一个 cookie 时，我们应该使用和设置 cookie 时相同的路径和域选项。")])]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"附录：第三方-cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附录：第三方-cookie","aria-hidden":"true"}},[s._v("#")]),s._v(" 附录：第三方 cookie")]),s._v(" "),e("p",[s._v("如果 cookie 是由用户所访问的页面的域以外的域放置的，则称其为第三方 cookie。")]),s._v(" "),e("p",[s._v("例如：")]),s._v(" "),e("ul",[e("li",[e("ol",[e("li",[e("code",[s._v("site.com")]),s._v(" 网站的一个页面加载了另外一个网站的 banner："),e("code",[s._v('<img src="https://ads.com/banner.png">')]),s._v("。")])])]),s._v(" "),e("li",[e("ol",{attrs:{start:"2"}},[e("li",[s._v("与 banner 一起，"),e("code",[s._v("ads.com")]),s._v(" 的远程服务器可能会设置带有 "),e("code",[s._v("id=1234")]),s._v(" 这样的 cookie 的 "),e("code",[s._v("Set-Cookie")]),s._v(" header。此类 cookie 源自 "),e("code",[s._v("ads.com")]),s._v(" 域，并且仅在 "),e("code",[s._v("ads.com")]),s._v(" 中可见：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(702),alt:""}})])]),s._v(" "),e("li",[e("ol",{attrs:{start:"3"}},[e("li",[s._v("下次访问 "),e("code",[s._v("ads.com")]),s._v(" 网站时，远程服务器获取 cookie "),e("code",[s._v("id")]),s._v(" 并识别用户：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(703),alt:""}})])]),s._v(" "),e("li",[e("ol",{attrs:{start:"4"}},[e("li",[s._v("更为重要的是，当用户从 "),e("code",[s._v("site.com")]),s._v(" 网站跳转至另一个也带有 banner 的网站 "),e("code",[s._v("other.com")]),s._v(" 时，"),e("code",[s._v("ads.com")]),s._v(" 会获得该 cookie，因为它属于 "),e("code",[s._v("ads.com")]),s._v("，从而识别用户并在他在网站之间切换时对其进行跟踪：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(704),alt:""}})])])]),s._v(" "),e("br"),s._v(" "),e("p",[s._v("由于它的性质，第三方 cookie 通常用于跟踪和广告服务。它们被绑定在原始域上，因此 "),e("code",[s._v("ads.com")]),s._v(" 可以在不同网站之间跟踪同一用户，如果这些网站都可以访问 "),e("code",[s._v("ads.com")]),s._v(" 的话。")]),s._v(" "),e("p",[s._v("当然，有些人不喜欢被跟踪，因此浏览器允许禁止此类 cookie。")]),s._v(" "),e("p",[s._v("此外，一些现代浏览器对此类 cookie 采取特殊策略：")]),s._v(" "),e("ul",[e("li",[s._v("Safari 浏览器完全不允许第三方 cookie。")]),s._v(" "),e("li",[s._v("Firefox 浏览器附带了一个第三方域的黑名单，它阻止了来自名单内的域的第三方 cookie。")])]),s._v(" "),e("br"),s._v(" "),e("div",{staticClass:"warning custom-block"},[e("p",[e("strong",[s._v("请注意：")])]),s._v(" "),e("p",[s._v("如果我们加载了一个来自第三方域的脚本，例如 "),e("code",[s._v('<script src="https://google-analytics.com/analytics.js">')]),s._v("，并且该脚本使用 "),e("code",[s._v("document.cookie")]),s._v(" 设置了 cookie，那么此类 cookie 就不是第三方的。")]),s._v(" "),e("p",[s._v("如果一个脚本设置了一个 cookie，那么无论脚本来自何处 —— 这个 cookie 都属于当前网页的域。")])]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"附录-gdpr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附录-gdpr","aria-hidden":"true"}},[s._v("#")]),s._v(" 附录: GDPR")]),s._v(" "),e("p",[s._v("本主题和 JavaScript 无关，只是设置 cookie 时的一些注意事项。")]),s._v(" "),e("p",[s._v("欧洲有一项名为 GDPR 的立法，该法规针对网站尊重用户实施了一系列规则。其中之一就是需要明确的许可才可以跟踪用户的 cookie。")]),s._v(" "),e("p",[s._v("请注意，这仅与跟踪/识别/授权 cookie 有关。")]),s._v(" "),e("p",[s._v("所以，如果我们设置一个只保存了一些信息的 cookie，但是既不跟踪也不识别用户，那么我们可以自由地设置它。")]),s._v(" "),e("p",[s._v("但是，如果我们要设置带有身份验证会话（session）或跟踪 id 的 cookie，那么必须得到用户的允许。")]),s._v(" "),e("p",[s._v("网站为了遵循 GDPR 通常有两种做法。你一定已经在网站中看到过它们了：")]),s._v(" "),e("ul",[e("li",[e("ol",[e("li",[s._v("如果一个网站想要仅为已经经过身份验证的用户设置跟踪的 cookie。")])]),s._v(" "),e("p",[s._v("为此，注册表单中必须要有一个复选框，例如“接受隐私政策”（描述怎么使用 cookie），用户必须勾选它，然后网站就可以自由设置身份验证 cookie 了。")])]),s._v(" "),e("li",[e("ol",{attrs:{start:"2"}},[e("li",[s._v("如果一个网站想要为所有人设置跟踪的 cookie。")])]),s._v(" "),e("p",[s._v("为了合法地这样做，网站为每个新用户显示一个模态“初始屏幕”，并要求他们同意设置 cookie。之后网站就可以设置 cookie，并可以让用户看到网站内容了。不过，这可能会使新用户感到反感。没有人喜欢看到“必须点击”的模态初始屏幕而不是网站内容。但是 GDPR 要求必须得到用户明确地准许。")])])]),s._v(" "),e("p",[s._v("GDPR 不仅涉及 cookie，还涉及其他与隐私相关的问题，但这超出了我们的讨论范围。")]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),e("p",[e("code",[s._v("document.cookie")]),s._v(" 提供了对 cookie 的访问")]),s._v(" "),e("ul",[e("li",[s._v("写入操作只会修改其中提到的 cookie。")]),s._v(" "),e("li",[s._v("name/value 必须被编码。")]),s._v(" "),e("li",[s._v("一个 cookie 最大为 4KB，每个网站最多有 20+ 个左右的 cookie（具体取决于浏览器）。")])]),s._v(" "),e("p",[s._v("Cookie 选项：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("path=/")]),s._v("，默认为当前路径，使 cookie 仅在该路径下可见。")]),s._v(" "),e("li",[e("code",[s._v("domain=site.com")]),s._v("，默认 cookie 仅在当前域下可见，如果显式设置了域，可以使 cookie 在子域下也可见。")]),s._v(" "),e("li",[e("code",[s._v("expires")]),s._v(" 或 "),e("code",[s._v("max-age")]),s._v(" 设置 cookie 过期时间，如果没有设置，则当浏览器关闭时 cookie 就失效了。")]),s._v(" "),e("li",[e("code",[s._v("secure")]),s._v(" 使 cookie 仅在 HTTPS 下有效。")]),s._v(" "),e("li",[e("code",[s._v("samesite")]),s._v("，如果请求来自外部网站，禁止浏览器发送 cookie，这有助于防止 XSRF 攻击。")])]),s._v(" "),e("p",[s._v("另外：")]),s._v(" "),e("ul",[e("li",[s._v("浏览器可能会禁用第三方 cookie，例如 Safari 浏览器默认禁止所有第三方 cookie。")]),s._v(" "),e("li",[s._v("在为欧盟公民设置跟踪 cookie 时，GDPR 要求必须得到用户明确许可。")])]),s._v(" "),e("br"),s._v(" "),e("br"),s._v(" "),e("br")])},[],!1,null,null,null);t.default=n.exports},701:function(s,t,a){s.exports=a.p+"assets/img/cookie-xsrf.0bb100b3.svg"},702:function(s,t,a){s.exports=a.p+"assets/img/cookie-third-party.20ca3ded.svg"},703:function(s,t,a){s.exports=a.p+"assets/img/cookie-third-party-2.e9dbd65f.svg"},704:function(s,t,a){s.exports=a.p+"assets/img/cookie-third-party-3.2b2f7826.svg"}}]);