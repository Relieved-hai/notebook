### js 中数字的位数

在 JavaScript 中，数字（无论是整数还是浮点数）在内存中的表示是 64 位双精度浮点数格式。
当使用 JavaScript 进行位运算（例如按位与、按位或等）时，操作数会临时被视为有符号的 32 位整数来处理，并按照这种格式进行计算。

<br/>
<br/>
<br/>

### 二进制的计算 （与、或、非、取反、异或、左移、右移、...）

**按位与（`&`）**

> 对两个数的二进制表示进行按位操作，只有两个相应的位都为 1 时，结果的那一位才为 1。

```js
  0b0000001000000000000000000000000
& 0b0000010000000000000000000000000
-----------------------------------
  0b0000000000000000000000000000000
```

<br/>

**按位或（`|`）**

> 对两个数的二进制表示进行按位操作，只要两个相应的位中有任何一个为 1，结果的那一位就为 1。

```js
  0b0000001000000000000000000000000
| 0b0000010000000000000000000000000
-----------------------------------
  0b0000011000000000000000000000000
```

<br/>

**按位非（`~`）**（按位取反、取反）

> 对单个数的二进制表示进行操作，将所有的 0 变为 1，所有的 1 变为 0。

```js
~ 0b0000001000000000000000000000000
-----------------------------------
  0b1111110111111111111111111111111
```

<br/>

**按位异或（`^`）**

> 对两个数的二进制表示进行按位操作，当两个相应的位不相同时，结果的那一位为 1；当两个相应的位相同时，结果的那一位为 0。

```js
  0b0000001000000000000000000000000
^ 0b0000000000000000000000000000000
-----------------------------------
  0b0000001000000000000000000000000
```

<br/>

**左移（`<<`）**

> 将数的二进制表示向左移动指定的位数，右边空出的位用 0 填充。

```js
<< 0b0000000000000000000000000000110 // << 2
------------------------------------
   0b0000000000000000000000000011000
```

<br/>

**右移（`>>`）**

> 将数的二进制表示向右移动指定的位数。对于有符号整数，左边空出的位用符号位填充（即正数时用 0，负数时用 1）。

```js
>> 0b0000000000000000000000000000110 // >> 2
------------------------------------
   0b0000000000000000000000000000001
```

<br/>

**无符号右移（`>>>`）**

> 将数的二进制表示向右移动指定的位数，左边空出的位始终用 0 填充。

```js
let a = -1;
let b = a >>> 1;

>>> 11111111111111111111111111111111 // a
------------------------------------
    01111111111111111111111111111111 // a >>> 1
```

<br/>
<br/>
<br/>

### 例子

```js
const LaneA = 0b00000000000000000000000001; // 优先级 A
const LaneB = 0b00000000000000000000000010; // 优先级 B
const LaneC = 0b00000000000000000000100000; // 优先级 C

let lane;

// 🌰：合并两个优先级
lane = LaneA | LaneB;

  0b00000000000000000000000001 // LaneA
| 0b00000000000000000000000010 // LaneB
------------------------------
  0b00000000000000000000000011 // lane


// 🌰：检查是否有优先级 B
if (lane & LaneB) {
  // 执行
}

  0b00000000000000000000000011 // lane
& 0b00000000000000000000000010 // LaneB
------------------------------
  0b00000000000000000000000010 // LaneB
```

```js
// 🌰：添加 LaneC 优先级
lane |= LaneC;

// 🌰：移除 LaneC 优先级
lane &= ~LaneC;
```

<br/>
<br/>
<br/>

```js
const LaneD = 0b0000000100000000000000000000000;
const LaneE = 0b0000001000000000000000000000000;

/**
 * 🌰：获取优先级最高的值（获取最右侧的1代表的值）
 *
 * fiber 对象对应了多个任务，每个任务都有对应的优先级，在 React 中数字越小，优先级越高。
 */

let lane;
lane |= LaneD; // 进来一个优先级 D
lane |= LaneE; // 进来一个优先级 E

lane & -lane; // 可以得到最右侧的 1 所对应的值

// -lane 负数如何表示?
// => 按位取反，然后加1（+1）,也称之为「补码」
~ 0b0000001100000000000000000000000
----------------------------------
  0b1111110011111111111111111111111 ~lane
+ 0b0000000000000000000000000000001 + 1（1+1 按位相加，二进制中 1+1 要进 1 位，自己变成 0）
----------------------------------
  0b1111110100000000000000000000000 -lane 的表示


  0b0000001100000000000000000000000 lane
& 0b1111110100000000000000000000000 -lane
----------------------------------
  0b0000000100000000000000000000000 lane & -lane 结果：LaneD（拿到了最右侧的 1 所对应的值，也就是高优先级的标识）
```
